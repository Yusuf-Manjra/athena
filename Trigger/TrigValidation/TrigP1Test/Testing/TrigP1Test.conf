# For a full documentation see:
# http://atlas-sw.cern.ch/cgi-bin/viewcvs-atlas.cgi/offline/Trigger/TrigValidation/TriggerTest/Testing/trigtest.conf?revision=HEAD&view=markup


#
# Note that references are on /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/
# the */online/* folder might be merged in the future with offline refernce area
#


################################################
# Infrastructure tests
################################################
test 1
  name HelloWorldHLT
  doc HelloWorld in athenaHLT
  checklog --config checklogTrigP1Test.conf --showexcludestats
  athena_cmd athenaHLT.py -n 10 -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_EnhancedBias.merge_eb_zee_zmumu_cc.RAW._lb0291._SFO-5._0001.data AthExHelloWorld/HelloWorldOptions.py

test 2
  name HelloWorldHLT_run_stop_run
  doc HelloWorld int athenaHLT with start/stop/start transition
  stdinfile run-stop-run-saveHist.trans
  checklog --config checklogTrigP1Test.conf --showexcludestats 
  extra_failure_codes ROOTCOMP_MISMATCH  
  athena_cmd athenaHLT.py -i --rewind -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_EnhancedBias.merge_eb_zee_zmumu_cc.RAW._lb0291._SFO-5._0001.data AthExHelloWorld/HelloWorldOptions.py

test 3
  name MTMonHistOH
  doc Histogram publishing test with OH infrastructure
  # note testMonHistOH.py invokes athenaHLT with  MTMonHist.py job options 
  # note that MTMonHist.py jo are in the HLT project
  pre_command get_joboptions MTMonHist.py
  athena_cmd testMonHistOH.py /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/atn-test/daq.physicsMCppv2.latest.data
  checklog --config checklogTrigP1Test.conf --showexcludestats

################################################################################
# Test of Physics_pp_V5 menu, main test of trigger, this is run on the PUs 
################################################################################

test 10
  name HLT_physicsV5
  doc athenaHLT on data with Physics_pp_v5 menu currenlty cosmics from M7
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST  /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5.reference
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5.root
  checkcount /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5.root 1 L2
  athena_cmd athenaHLT.py -o HLT_physicsV5  -n 100 -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/M6
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST  /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5.reference
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5.root
  checkcount /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5.root 1 L2
  athena_cmd athenaHLT.py   -o HLT_physicsV5  -n 100 -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data14_cos.00247688.physics_CosmicMuons.merge.RAW._lb0347._SFO-7EE150evts._0001.1 -c 'testPhysicsV5=True;HLTOutputLevel=INFO;doValidation=True' TriggerRelease/runHLT_standalone.py
  post_command ln -s data14_cos.00247688.physics_CosmicMuons.merge.RAW._lb0347._SFO-7EE150evts._0001.1.data HLT_physicsV5-1._0001.data	
  post_command save_to_refdir.sh HLT_physicsV5-1._0001.data /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest
  post_command chainDump.py -n -S
  post_test checkHist histSizes.py -t expert-monitoring.root ; cp post_test_checkHist.log checkHistathenaHLT.reference.new ; diff checkHistathenaHLT.reference.new /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/checkHistathenaHLT.reference 



test 13
  name HLT_physicsV5_rerunlvl1
  doc athenaHLT on data with Physics_pp_v5 menu currenlty cosmics from M7
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST  /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5_rerunlvl1.reference
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5_rerunlvl1.root
  checkcount /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5_rerunlvl1.root 1 L2
  athena_cmd athenaHLT.py -o HLT_physicsV5_rerunlvl1  -n 100 -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/M6
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST  /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5_rerunlvl1.reference
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5_rerunlvl1.root
  checkcount /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5_rerunlvl1.root 1 L2
  athena_cmd athenaHLT.py   -o HLT_physicsV5_rerunlvl1  -n 100 -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data14_cos.00247688.physics_CosmicMuons.merge.RAW._lb0347._SFO-7EE150evts._0001.1 -c 'testPhysicsV5=True;HLTOutputLevel=INFO;doValidation=True;rerunLVL1=True' TriggerRelease/runHLT_standalone.py
  post_command ln -s data14_cos.00247688.physics_CosmicMuons.merge.RAW._lb0347._SFO-7EE150evts._0001.1.data HLT_physicsV5_rerunlvl1-1._0001.data	
  post_command save_to_refdir.sh HLT_physicsV5_rerunlvl1-1._0001.data /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest
  post_command chainDump.py -n -S
  post_test checkHist histSizes.py -t expert-monitoring.root ; cp post_test_checkHist.log checkHistathenaHLT.reference.new ; diff checkHistathenaHLT.reference.new /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/checkHistathenaHLT.reference 


test 15
  name HLT_physicsV5_L1TopoRoI
  doc athenaHLT on data including L1Topo RoI decoding to RoIBResult with Physics_pp_v5 menu currently cosmics from M7 with sim L1Topo ROBFs merged in
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST  /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5_L1TopoRoI.reference
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5_L1TopoRoI.root
  checkcount /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5_L1TopoRoI.root 1 L2
  athena_cmd athenaHLT.py  -o HLT_physicsV5_L1TopoRoI  -n 10 -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data14_cos.00247688_mergedL1Topo._0001.data --extra-l1r-robs '[9502848,9502864]' --log-level INFO,ERROR -c 'testPhysicsV5=True;doValidation=True;L1TopoCheck=True' TriggerRelease/runHLT_standalone.py
  #post_command ln -s data14_cos.00247688.physics_CosmicMuons.merge.RAW._lb0347._SFO-7EE150evts._0001.1.data HLT_physicsV5-1._0001.data	
  #post_command save_to_refdir.sh HLT_physicsV5-1._0001.data /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest
  post_command chainDump.py -S
  post_test checkHist histSizes.py -t expert-monitoring.root ; cp post_test_checkHist.log checkHistathenaHLT.reference.new ; diff checkHistathenaHLT.reference.new /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/checkHistathenaHLT.reference 




################################################################################
# Test of  MC_pp_V5 menu, will include "slow" cosmics chains from physics_pp_v5 menu--> need to split this test in two  
# for the time being run this on enhanced bias, will probably time out
################################################################################

test 11
  name HLT_mcV5
  doc AthenaHLT on data, with MC_pp_V5 menu loose prescale set
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST  /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_mcV5.reference
  checkcount /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_mcV5.root 1 L2
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_mcV5.root 
  athena_cmd athenaHLT.py -o HLT_mcV5 -n 105  -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_EnhancedBias.merge_eb_zee_zmumu_cc.RAW._lb0291._SFO-5._0001.data -c 'testMCV5=True;rerunLVL1=True;HLTOutputLevel=INFO;doValidation=True;useCONDBR2=False;setGlobalTag="COMCOND-HLTP-004-03";setDetDescr="ATLAS-R1-2012-02-00-00"' TriggerRelease/runHLT_standalone.py 
  post_command ln -s data12_8TeV.00212967.physics_EnhancedBias.HLT_mcV5.RAW._lb0291._athenaHLT._0001.data HLT_mcV5-1._0001.data	
  post_command save_to_refdir.sh HLT_mcV5-1._0001.data /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest
  post_command chainDump.py -n -S



################################################
# Athena test on format writing RDO to BS and comparison to athenaHLT run
################################################


test 20
  name AthenaP1RDO
  doc Athena on Monte Carlo events, produces xml file for menu
  athena_cmd athena.py -c "doRates=False" TrigP1Test/testAthenaP1RDO.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  regtest TrigSteer_L2.TrigChainMoniValidation  REGTEST /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/AthenaP1RDO_L2.TrigChainMoniValidation.reference
  regtest TrigSteer_EF.TrigChainMoniValidation  REGTEST /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/AthenaP1RDO_EF.TrigChainMoniValidation.reference
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/AthenaP1RDO.root
  checkcount /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/AthenaP1RDO.root 1 BOTH
  pre_command RecExCommon_links.sh
  post_command chainDump.py -n -S

test 21
  name AthenaP1RDOtoBS
  doc Run RDO->BS using ttbar MC file
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest    REGTEST /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/AthenaP1RDOtoBS.reference
  rootcomp /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/AthenaP1RDOtoBS.root
  athena_cmd athena.py -c 'setMenu="MC_pp_v5";writeBS=True;rerunLVL1=True;PoolRDOInput=["/afs/cern.ch/atlas/project/trigger/pesa-sw/validation/atn-test/mc12_8TeV.105200.McAtNloJimmy_CT10_ttbar_LeptonFilter.digit.RDO.e1513_s1499_s1504_d700_10evt.pool.root"];myBSRDOOutput="AppName=Athena, OutputDirectory=./, FileTag="+setMenu+", Run=105200"' TriggerRelease/Trigger_topOptions_writeBS.py
  post_command test -e  data_test.00105200.Single_Stream.daq.RAW._lb0006._Athena._0001.data


test 22
  name AthenaP1BS_standalone
  doc Standalone HLT running in athena and compare to athenaHLT
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/AthenaP1BS_standalone.reference
  rootcomp ../HLT_physicsV5/expert-monitoring.root expert-monitoring.root
  checkcount ../HLT_physicsV5/expert-monitoring.root 0 BOTH 
  athena_cmd athena.py -c "BSRDOInput='root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data';testPhysicsV5=True;writeBS=True;rerunLVL1=True;doValidation=True;setDetDescr='ATLAS-R1-2012-02-00-00';useCONDBR2=False;setGlobalTag='COMCOND-HLTP-004-03';EvtMax=10" TriggerRelease/runHLT_standalone.py 
  post_command chainDump.py -n -S



###########################################################
# Full menu tests on Monte Carlo using AthenaHLT
###########################################################
#

test 30
  name HLT_MC_BSfromRDO
  doc athenaHLT on MC with MC menu, input from AthenaP1RDOtoBS
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_MC_BSfromRDO.reference
  checkcount /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_MC_BSfromRDO.root 0 BOTH
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_MC_BSfromRDO.root
# note ._0001.data is added automatically
  pre_condition test -e ../AthenaP1RDOtoBS/data_test.00105200.Single_Stream.daq.RAW._lb0016._Athena._0001.data
  # The geometry and conditions tag need to match the ones used in AthenaP1RDOtoBS
  athena_cmd athenaHLT.py -l DEBUG -f ../AthenaP1RDOtoBS/data_test.00105200.Single_Stream.daq.RAW._lb0016._Athena._0001.data -c 'HLTOutputLevel=DEBUG;testMCV5MC=True;rerunLVL1=True;setDetDescr="ATLAS-R1-2012-02-00-00";setGlobalTag="OFLCOND-DR-BS7T-ANom-11";setPrescale="";doValidation=True' TriggerRelease/runHLT_standalone.py
  post_command chainDump.py -n -S


######################################################################################
#
# Tests for T0 Reconstruction on a BS file produced with P1HLT cache currently, running on cosmics during M7 and M8 included in physics_v5
# 
######################################################################################
test 40
  name  RAWtoESD_physicsV5_savedBS
  doc Reco_tf on saved output from HLT_physicsV5
  checklog --config checklogTrigP1Test.conf --showexcludestats
  pre_command linktoP1HLT.sh physicsV5
  athena_cmd Reco_tf.py  --inputBSFile link_to_file_from_P1HLT.data  --maxEvents 10  --outputESDFile RAWtoESD.pool.root --ignoreErrors True
  post_command checkFile.py RAWtoESD.pool.root > ESD.txt  

 
test 41
  name  TrigEDMCheck_physicsV5_savedBS
  doc EDMCheck on RAWtoESD_physicsV5_savedBS
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST  /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/TrigEDMCheck_physicsV5_savedBS.reference  
  pre_condition test -e ../RAWtoESD_physicsV5_savedBS/data12_physicsV5.ESD.pool.root
  pre_command ln -s ../RAWtoESD_physicsV5_savedBS/data12_physicsV5.ESD.pool.root ESD.pool.root
  athena_cmd athena.py -c 'fileList=["ESD.pool.root"]' TrigP1Test/testAthenaP1ESD_TrigEDMCheck_data.py



################################################################################
#  physics_v5 menu on cosmics 2012  
################################################################################

test 50
  name HLT_physicsV5_COS_2012
  doc athenaHLT standalone with physicsV5 menu on COSMICS 2012
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST  /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5_COS_2012.reference
  checkcount /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5_COS_2012.root 1 L2
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5_COS_2012.root 
  athena_cmd athenaHLT.py -o HLT_physicsV5_COS_2012 -n 100 -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_cos.00214912.express_express.merge.RAW._lb0184._SFO-ALL._0001.1  -c 'testPhysicsV5=True;HLTOutputLevel=INFO;doValidation=True;useCONDBR2=False;setGlobalTag="COMCOND-HLTP-004-03";setDetDescr="ATLAS-R1-2012-02-00-00"' TriggerRelease/runHLT_standalone.py  	
  post_command save_to_refdir.sh HLT_physicsV5_COS_2012-1._0001.data /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest
  post_command chainDump.py -n -S


test 51
  name HLT_physicsV5_COS_M7MUONS
  doc athenaHLT on data with Physics_pp_v5 menu currenlty cosmics from M7
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST  /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5_COS_M7MUONS.reference
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5_COS_M7MUONS.root
  checkcount /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5_COS_M7MUONS.root 1 L2
  athena_cmd athenaHLT.py -o HLT_physicsV5_COS_M7MUONS  -n 100 -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data14_cos.00247688.physics_CosmicMuons.merge.RAW._lb0347._SFO-7EE150evts._0001.1  -c 'testPhysicsV5=True;HLTOutputLevel=INFO;doValidation=True' TriggerRelease/runHLT_standalone.py
  post_command ln -s data14_cos.00247688.physics_CosmicMuons.merge.RAW._lb0347._SFO-7EE150evts._0001.1.data HLT_physicsV5_COS_M7MUONS-1._0001.data	
  post_command save_to_refdir.sh HLT_physicsV5_COS_M7MUONS-1._0001.data /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest
  post_command chainDump.py -n -S
  post_test checkHist histSizes.py -t expert-monitoring.root ; cp post_test_checkHist.log checkHistathenaHLT.reference.new ; diff checkHistathenaHLT.reference.new /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/checkHistathenaHLT.reference 


test 52
  name HLT_physicsV5_COS_M7IDCOSMICS
  doc athenaHLT on data with Physics_pp_v5 menu currenlty cosmics from M7
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST  /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5_COS_M7IDCOSMICS.reference
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5_COS_M7IDCOSMICS.root
  checkcount /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5_COS_M7IDCOSMICS.root 1 L2
  athena_cmd athenaHLT.py  -o HLT_physicsV5_COS_M7IDCOSMICS  -R 247688 -n 100 -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data14_cos.00247688.physics_HLIDCosmic.merge.RAW.lb034X.SFO-ALL_0001.1 -c 'testPhysicsV5=True;HLTOutputLevel=INFO;doValidation=True' TriggerRelease/runHLT_standalone.py
  post_command ln -s data14_cos.00247688.physics_HLIDCosmic.merge.RAW.lb034X.SFO-ALL_0001.1.data HLT_physicsV5_COS_M7IDCOSMICS-1._0001.data	
  post_command save_to_refdir.sh HLT_physicsV5_COS_M7IDCOSMICS-1._0001.data /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest
  post_command chainDump.py -n -S
  post_test checkHist histSizes.py -t expert-monitoring.root ; cp post_test_checkHist.log checkHistathenaHLT.reference.new ; diff checkHistathenaHLT.reference.new /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/checkHistathenaHLT.reference 

test 53
  name HLT_physicsV5_COS_M8EXPRESS
  doc athenaHLT on data with Physics_pp_v5 menu currenlty cosmics from M8
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST  /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5_COS_M8EXPRESS.reference
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5_COS_M8EXPRESS.root
  checkcount /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5_COS_M8EXPRESS.root 1 L2
  athena_cmd athenaHLT.py -o HLT_physicsV5_COS_M8EXPRESS  -n 100 -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data15_cos.00251367.express_express.merge.RAW._lb0194._SFO-8._0001.1  -c 'testPhysicsV5=True;HLTOutputLevel=INFO;doValidation=True' TriggerRelease/runHLT_standalone.py
  post_command ln -s data15_cos.00251367.express_express.merge.RAW._lb0194._SFO-8._0001.1 HLT_physicsV5_COS_M8EXPRESS-1._0001.data	
  post_command save_to_refdir.sh HLT_physicsV5_COS_M8EXPRESS-1._0001.data /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest
  post_command chainDump.py -n -S
  post_test checkHist histSizes.py -t expert-monitoring.root ; cp post_test_checkHist.log checkHistathenaHLT.reference.new ; diff checkHistathenaHLT.reference.new /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/checkHistathenaHLT.reference

################################################################################
#  DB upload tests on Physics_pp_V5 menu  inclusing running from the db (currently not possible as old triggertool has no cmdline option top run old physics_pp lvl1 menu)
################################################################################


 
test 61
  name HLT_physicsV5_menu
  doc Run athenaHLT on all events to create trigger configuration
  checklog --config checklogTrigP1Test.conf --showexcludestats
  athena_cmd athenaHLT.py -M -n 100 -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data14_cos.00247688.physics_CosmicMuons.merge.RAW._lb0347._SFO-7EE150evts._0001.1 -o HLT_physicsV5_menu  -c 'testPhysicsV5=True;trigBase="Default";doDBConfig=True' TriggerRelease/runHLT_standalone.py

test 62
  name UploadMenuKeys
  doc Generates and uploads SMKs created from the HLT first and compares after rerun jobs from DB.
  #pre_condition test -e ../HLT_physicsV5_menu/outputHLTconfig_L2PU-1.xml # still needed?
  pre_condition test -e ../HLT_physicsV5_menu/ef_Default_setup.txt 
  pre_condition test -e	../HLT_physicsV5_menu/ef_Default_setup_setup.txt 
  athena_cmd testUploadMenuKeys.sh HLT_physicsV5


test 63
  name HLT_physicsV5_rerun 
  doc Recreate trigger configuration and compare with configuration from HLT_physicsV5_menu
  athena_cmd athenaHLT.py -M -n 100 -f  root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data14_cos.00247688.physics_CosmicMuons.merge.RAW._lb0347._SFO-7EE150evts._0001.1  -o HLT_physicsV5_rerun -c 'testPhysicsV5=True;trigBase="Default";doDBConfig=True' TriggerRelease/runHLT_standalone.py


test 64
  name CheckKeysV5
  doc compare the SMK created from the HLT_physicsV5 first and rerun jobs 
  pre_condition test -e ../HLT_physicsV5_menu/ef_Default_setup.txt 
  pre_condition test -e	../HLT_physicsV5_menu/ef_Default_setup_setup.txt 
  pre_condition test -e ../HLT_physicsV5_rerun/ef_Default_setup.txt 
  pre_condition test -e	../HLT_physicsV5_rerun/ef_Default_setup_setup.txt 
  checklog --config checklogTrigP1Test.conf --showexcludestats | grep -v "checking for"
  athena_cmd testCheckKeys.sh HLT_physicsV5



test 65
  name HLT_physicsV5_menu_rerundb
  doc athenaHLT from DB, use HLT_physicsV5 as reference
  checklog --config checklogTrigP1Test.conf --showexcludestats
  rootcomp   ../HLT_physicsV5_menu/expert-monitoring.root expert-monitoring.root
  extra_failure_codes ROOTCOMP_MISMATCH  
  pre_condition test -e ../UploadMenuKeys/exportMenuKeys.sh
  athena_cmd unset FRONTIER_SERVER; source ../UploadMenuKeys/exportMenuKeys.sh; athenaHLT.py -M -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data -oHLT_physicsV5_menu_rerundb -J TrigConf::HLTJobOptionsSvc --use-database --db-type "Coral" --db-server "TRIGGERDBATN" --db-smkey ${smk} --db-hltpskey ${hltpsk} --db-extra "{'lvl1key': ${l1psk}}"
  #athena_cmd source ../UploadMenuKeys/exportMenuKeys.sh; athenaHLT.py -M -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data -oHLT_physicsV5_menu_rerundb -J TrigConf::HLTJobOptionsSvc --use-database "DBServer=TRIGGERDBATN:Instance=HLT:DBSMKey=${smk}:DBHLTPSKey=${hltpsk}:DBLVL1PSKey=${l1psk}" 
  post_command chainDump.py -n -S
  post_test RunMsg check_msg_stat.py --showignored --config checkMsgStat_TrigP1Test.conf $logfile

test 66
  name HLT_physicsV5_prescaleChange
  doc Test of HLT prescale change
  checklog --config checklogTrigP1Test.conf --showexcludestats
  pre_condition test -e ../UploadMenuKeys/exportMenuKeys.sh
  pre_condition test -e ../UploadMenuKeys/prescales.txt
  pre_command ln -sf ../UploadMenuKeys/prescales.txt
  pre_command get_files -jo testPrescaleChange_postconfig.py
  athena_cmd source ../UploadMenuKeys/exportMenuKeys.sh; athenaHLT.py -Z TrigP1Test.PrescaleChange -C 'include("testPrescaleChange_postconfig.py")' -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data -J TrigConf::HLTJobOptionsSvc --use-database "DBServer=TRIGGERDBATN:Instance=L2:DBSMKey=${smk}:DBHLTPSKey=${hltpsk}:DBLVL1PSKey=${l1psk}"

test 67
  name TriggerDBAccessTest
  doc Access TriggerDB using Oracle and Frontier and compare
# pre_condition test -e ../UploadMenuKeys/exportMenuKeys.sh
  athena_cmd testAccessDBAndCompare.sh

#############################################################################################
## Transform tests on BS from main  HLT_physicsV5 test
#############################################################################################    
test 80
  name RAWtoESD_physicsV5
  doc RAWtoESD on output from HLT_physicsV5
  checklog --config checklogTrigP1Test.conf --showexcludestats
  pre_condition test -e '../HLT_physicsV5/HLT_physicsV5-1._0001.data'
  athena_cmd Reco_tf.py  --inputBSFile ../HLT_physicsV5/HLT_physicsV5-1._0001.data   --maxEvents 5 --outputESDFile RAWtoESD.pool.root --ignoreErrors True
  post_command checkFile.py RAWtoESD.pool.root > ESD.txt

test 81
  name TrigEDMCheck_physicsV5
  doc EDM checker on ESD from RAWtoESD_physicsV5
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest    REGTEST  /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/TrigEDMCheck_physicsV5.reference
  pre_condition test -e ../RAWtoESD_physicsV5/RAWtoESD.pool.root
  pre_command ln -s ../RAWtoESD_physicsV5/RAWtoESD.pool.root ESD.pool.root
  athena_cmd athena.py -c 'fileList=["ESD.pool.root"]' TrigP1Test/testAthenaP1ESD_TrigEDMCheck_data.py

test 82
  name TrigDecTool_physicsV5
  doc  Check of TrigDec for events produced by RAWtoESD_physicsV5
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest    REGTEST /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/TrigDecTool_physicsV5.reference
  pre_condition test -e ../RAWtoESD_physicsV5/RAWtoESD.pool.root
  pre_command ln -s ../RAWtoESD_physicsV5/RAWtoESD.pool.root ESD.pool.root
  athena_cmd athena.py -c 'fileList=["ESD.pool.root"]' TrigP1Test/testAthenaP1ESD_TrigDecTool.py

test 83
  name Reco_tf_mcV5_savedBS
  doc Reco_tf on saved output from HLT_mcV5
  checklog --config checklogTrigP1Test.conf --showexcludestats
  pre_command linktoP1HLT.sh mcV5   
  athena_cmd Reco_tf.py --inputBSFile link_to_file_from_P1HLT.data --maxEvents 10   --outputESDFile data12_mcV5.ESD.pool.root --ignoreErrors True
  

#############################################################################################
## Infrastructure tests on run/stop/run transitions
############################################################################################# 
test 100
  name HLT_physicsV5_run_stop_run
  doc athenaHLT on data with physics_pp_V5 menu with stop/start transition
  stdinfile run-stop-run-saveHist.trans
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  customregtest regtest_multirun.sh atn_test.log
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_physicsV5.root
  #extra_failure_codes ROOTCOMP_MISMATCH ATHENA_REGTEST_FAILED  
  #-i is interactive
  athena_cmd athenaHLT.py -i  --rewind  -n 5 -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data14_cos.00247688.physics_CosmicMuons.merge.RAW._lb0347._SFO-7EE150evts._0001.1   -oHLT_physicsV5_run_stop_run -c 'testPhysicsV5=True;HLTOutputLevel=INFO;doValidation=True' TriggerRelease/runHLT_standalone.py

test 101
  name HLT_MC_run_stop_run
  doc MC menu with start/stop/start transition
  filterlog filterREGTEST.py
  stdinfile run-stop-run-saveHist.trans
  checklog --config checklogTrigP1Test.conf --showexcludestats
  customregtest regtest_multirun.sh atn_test.log
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_mcV5.root
  extra_failure_codes ROOTCOMP_MISMATCH ATHENA_REGTEST_FAILED
  pre_condition test -e ../AthenaP1RDOtoBS/data_test.00105200.Single_Stream.daq.RAW._lb0016._Athena._0001.data
  athena_cmd athenaHLT.py -i --rewind -f ../AthenaP1RDOtoBS/data_test.00105200.Single_Stream.daq.RAW._lb0016._Athena._0001.data -oHLT_MC_run_stop_run -c'testMCV5MC=True;setPrescale="None";useCONDBR2=False;setDetDescr="ATLAS-R1-2012-02-00-00";setGlobalTag="OFLCOND-DR-BS7T-ANom-11";HLTOutputLevel=INFO;doValidation=True;rerunLVL1=True' TriggerRelease/runHLT_standalone.py


#############################################################################################
## Additional Infrastructure tests 
#############################################################################################

# mrammens: localhost partition test goes to a new test suite-- remove this test here 
test 111
  name AllPartition_physicsV5
  doc Physics_pp_v4 menu in localhost L2+EF partition
  joboptions runHLT_standalone.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  athena_cmd part_runTest.sh part_lhl2ef 
  customregtest part_regtest.sh ../HLT_physicsV5/HLT_physicsV5.reference.new ../HLT_physicsV5/HLT_physicsV5.reference.new  
  customrootcomp part_rootcomp.sh ../HLT_physicsV5/expert-monitoring.root  ../HLT_physicsV5/expert-monitoring.root
  post_command cleanuplog.sh runHLT_standalone_test.log

test 112
  name HLT_physicsV5_magField_on_off_on
  doc athenaHLT on data with physicsV5 menu with On and Off magnetic field transition
  pre_command  get_files -jo setMagFieldCurrents.py
  stdinfile magFieldOnOff.trans
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  customregtest regtest_multirun.sh atn_test.log 1 3
  rootcomp run_1.root run_2.root
  extra_failure_codes ROOTCOMP_MISMATCH ATHENA_REGTEST_FAILED  
# -i is interactive, -M turns on monitoring
  athena_cmd athenaHLT.py -i  -M -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data -oHLT_physicsV5_magField_on_off_on -c 'testPhysicsV5=True;HLTOutputLevel=INFO;doValidation=True;useCONDBR2=False;setGlobalTag="COMCOND-HLTP-004-03";setDetDescr="ATLAS-R1-2012-02-00-00";EvtMax=5' TriggerRelease/runHLT_standalone.py

test 113
  name HLT_physicsV5_beamspot
  doc Test of beamspot udpate with athenaHLT
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  athena_cmd athenaHLT.py -Z TrigP1Test.BeamSpotUpdate -n 5 -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data -c 'testPhysicsV5=True;doValidation=True;BeamspotFromSqlite=True;useCONDBR2=False;setGlobalTag="COMCOND-HLTP-004-03";setDetDescr="ATLAS-R1-2012-02-00-00"' TriggerRelease/runHLT_standalone.py

test 114
  name HLT_physicsV5_nocache
  doc athenaHLT on data with physics_pp_v5 menu, no caching in steering, use HLT_physicsV5 as reference
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  checkcount ../HLT_physicsV5/expert-monitoring.root 0 L2
  athena_cmd athenaHLT.py -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data -oHLT_physicsV5_nocache  -c 'testPhysicsV5=True;noCaching=True;HLTOutputLevel=INFO;doValidation=True;useCONDBR2=False;setGlobalTag="COMCOND-HLTP-004-03";setDetDescr="ATLAS-R1-2012-02-00-00"' TriggerRelease/runHLT_standalone.py

test 115
  name tfTestPPV5
  doc Check tf for menu PP V5 data
  pre_command xrdcp root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data .
  pre_condition test -e ../UploadMenuKeys/exportMenuKeys.sh
  checklog --config checklogTrigP1Test.conf --showexcludestats
  athena_cmd source ../UploadMenuKeys/exportMenuKeys.sh; BatchHLTTrf_wrap.py inputBSFile=data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data outputRAWFile=RAW.999999._000001.data.1 doStreaming=True filters="express" stream_out=debug connection=TRIGGERDBATN smk=${smk} lvl1ps=${l1psk} hltps=${hltpsk} outputNTUP_TRIGCOSTEFFile=NTUP_TRIGCOSTEF.root outputNTUP_TRIGCOSTL2File=NTUP_TRIGCOSTL2.root outputNTUP_TRIGRATEEFFile=NTUP_TRIGRATEEF.root outputNTUP_TRIGRATEL2File=NTUP_TRIGRATEL2.root outputHIST_HLTMONEFFile=HIST_HLTMONEF.root outputHIST_HLTMONL2File=HIST_HLTMONL2.root max_events=10




################################################################################
# Test of mcV5 menu for CAF reprocessing 
################################################################################

test 130
  name HLT_mcV5_caf
  doc athenaHLT on data with MC_pp_V5 menu for caf reprocessing  
  checklog --config checklogTrigP1Test.conf --showexcludestats
  athena_cmd athenaHLT.py -n 1 -M -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data  -oHLT_mcV5_caf  -c 'testMCV5=True;caf=True;trigBase="Default";doDBConfig=True;useCONDBR2=False;setGlobalTag="COMCOND-HLTP-004-03";setDetDescr="ATLAS-R1-2012-02-00-00"' TriggerRelease/runHLT_standalone.py

test 131
  name HLT_physicsV5_caf
  doc athenaHLT on data with Physics_pp_V5 menu for caf reprocessing  
  checklog --config checklogTrigP1Test.conf --showexcludestats
  athena_cmd athenaHLT.py -n 1 -M -f root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data12_8TeV.00212967.physics_eb_zee_zmumu_cc._0001.data  -oHLT_physicsV5_caf  -c 'testPhysicsV5=True;caf=True;trigBase="Default";doDBConfig=True;useCONDBR2=False;setGlobalTag="COMCOND-HLTP-004-03";setDetDescr="ATLAS-R1-2012-02-00-00"' TriggerRelease/runHLT_standalone.py

test 132
  name PrepareMenuKeys_physicsV5_caf
  doc Prepares SMKs created from the HLT_physicsV5_caf  tests
  pre_condition test -e ../HLT_physicsV5_caf/outputHLTconfig_L2PU-1.xml
  pre_condition test -e ../HLT_physicsV5_caf/l2_Default_setup.txt
  pre_condition test -e ../HLT_physicsV5_caf/l2_Default_setup_setup.txt
  pre_condition test -e ../HLT_physicsV5_caf/ef_Default_setup.txt
  pre_condition test -e ../HLT_physicsV5_caf/ef_Default_setup_setup.txt

  athena_cmd testPrepareMenuKeysSelfX.sh physicsV5_caf


test 133
  name PrepareMenuKeys_mcV5_caf
  doc Prepares SMKs created from the All*T_mcV5_caf tests
  pre_condition test -e ../HLT_mcV5_caf/outputHLTconfig_L2PU-1.xml
  pre_condition test -e ../HLT_mcV5_caf/l2_Default_setup.txt
  pre_condition test -e ../HLT_mcV5_caf/l2_Default_setup_setup.txt
  pre_condition test -e ../HLT_mcV5_caf/ef_Default_setup.txt
  pre_condition test -e ../HLT_mcV5_caf/ef_Default_setup_setup.txt

  athena_cmd testPrepareMenuKeysSelfX.sh mcV5_caf 

test 134
  name PrepareMenuKeys_p1
  doc Prepares SMKs created from the  All*T_physicsV5_menu test 
  pre_condition test -e ../HLT_physicsV5_menu/outputHLTconfig_L2PU-1.xml
  pre_condition test -e ../HLT_physicsV5_menu/l2_Default_setup.txt
  pre_condition test -e ../HLT_physicsV5_menu/l2_Default_setup_setup.txt
  pre_condition test -e ../HLT_physicsV5_menu/ef_Default_setup.txt
  pre_condition test -e ../HLT_physicsV5_menu/ef_Default_setup_setup.txt

  athena_cmd testPrepareMenuKeysSelfX.sh physicsV5_menu




##Heavy Ion menu tests
#
#
#
#
test 160
  name HLT_HIV3
  doc athenaHLT standalone with HLT_HIV3 menu on a HI sample
  filterlog filterREGTEST.py
  checklog --config checklogTrigP1Test.conf --showexcludestats
  fullregtest REGTEST  /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_HIV3.reference
  checkcount /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_HIV3.root 1 L2
  rootcomp   /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest/HLT_HIV3.root
  athena_cmd athenaHLT.py -o HLT_HIV3 -n 100 -f  'root://eosatlas//eos/atlas/atlascerngroupdisk/trig-daq/validation/test_data/data11_hi.00193403.physics_HardProbes.merge.RAW._lb0012._SFO-9._0001.1' -c 'testHIV3=True;rerunLVL1=True;setPrescale="None";HLTOutputLevel=INFO;doValidation=True;useCONDBR2=False;setGlobalTag="COMCOND-HLTP-004-03";setDetDescr="ATLAS-R1-2012-02-00-00"' TriggerRelease/runHLT_standalone.py
  post_command save_to_refdir.sh HLT_HIV3-1._0001.data /afs/cern.ch/atlas/project/trigger/pesa-sw/validation/online/references/ATN/latest
  post_command chainDump.py -n -S


