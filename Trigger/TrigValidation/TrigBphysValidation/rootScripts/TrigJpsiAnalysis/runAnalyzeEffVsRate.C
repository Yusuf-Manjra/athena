/*
  Copyright (C) 2002-2017 CERN for the benefit of the ATLAS collaboration
*/

// Generated by runAnalyzeChain.py
#include <vector>
#include <string>
#include "Log.h"
// #include "TSystem.h"
// #include "TH1F.h"
// #include "TGraph.h"
// #include "TrigJpsiRootAnalysis.h"

void runAnalyzeEffVsRate() {
  gSystem->Load("TrigJpsiRootAnalysis_cpp.so");

  std::vector<std::string> files(1, "/net/s3_datac/scheiric/data/output_TriggerJpsiAnalysis/2010-05-10/rootfiles/user10.DanielScheirich.06.data10_7TeV_MuonswBeam.00153599.TriggerJpsiAnalysis.EXT0._00021.bphys.root");

  const int n=3;
  TGraph* g[n];
  for(int j=0; j<n ;++j) {
    TrigJpsiRootAnalysis analysisEff(INFO, "/net/s3_datac/scheiric/data/output_TriggerJpsiAnalysis/2010-05-11/rootfiles");
    TrigJpsiRootAnalysis analysisRate(INFO, "/net/s3_datac/scheiric/data/output_TriggerJpsiAnalysis/2010-05-11/rootfiles");
//     TrigJpsiRootAnalysis analysisRate(INFO, files);

    std::string cut = " NMuHits("+iToStr(3+2*j)+") ";

    analysisEff.analyzeChain("L2_MU4_DiMu_FS_noOS", "gaus+pol1 fitMin=2000 fitMax=5000 massBinLo=8 massBinHi=13", cut+"Level1(L1_MU0) JpsiMass(2000,5000) JpsiChi2Prob(0.05) TrkChi2OnNdf(3.5) MuonPt(2500) MuonE(3000) MuonPixHits(1) MuonSctHits(6) MuonMdtHits(5) MuonTypes(ONE_COMB) NMuHits(3) ");
    analysisRate.analyzeRate("L2_MU4_DiMu_FS_noOS", "", cut+"Level1(L1_MU0) JpsiMass(2000,5000) JpsiChi2Prob(0.05) TrkChi2OnNdf(3.5) MuonPt(2500) MuonE(3000) MuonPixHits(1) MuonSctHits(6) MuonMdtHits(5) MuonTypes(ONE_COMB) NMuHits(3) ");

    TH1F* h_num_vtx  = analysisEff.getHist(std::string("num_vtx"));
    TH1F* h_rate_vtx = analysisRate.getHist(std::string("rate_vtx"));

//     TGraph* gr = new TGraph(1);
//     gr->SetPoint(0,j,j);
//     g[j] = gr;

    if(h_num_vtx!=NULL && h_rate_vtx!=NULL && h_num_vtx->GetNbinsX() == h_rate_vtx->GetNbinsX()) {
      TGraph* gr = new TGraph(h_num_vtx->GetNbinsX());
      g[j] = gr;

      for(int i=1; i<=h_num_vtx->GetNbinsX(); ++i) {
        gr->SetPoint(i-1, h_rate_vtx->GetBinContent(i)/analysisRate.getNEntries(), h_num_vtx->GetBinContent(i)/analysisEff.getNCandidates());
      }

    }
  }

  new TCanvas("c_effVsRate","c_effVsRate");
  TH2F* axs = new TH2F("axs",";Reduction factor;Efficiency",100,0.001,0.02,100,0,1);
  axs->SetStats(0);
  axs->Draw();

  TLegend* leg = new TLegend(0.6,0.5,0.9,0.3);

  for(int j=0; j<n; ++j) {
    g[j]->SetMarkerColor(kBlue+2*j);
    g[j]->Draw("p");
    char tmp[100];
    sprintf(tmp, "No. of muon hits #geq %i", 3+2*j);
    leg->AddEntry(g[j], tmp,"p");
  }

  leg->SetFillColor(kWhite);
  leg->Draw("same");

  TArrow* a = new TArrow(0.01,0.4,0.0065,0.28,   0.05,"|>");
  a->SetLineWidth(2);
  a->Draw();

  TLatex* lt;
  lt = new TLatex(0.012,0.64,"#chi^{2} < 1000");
  lt->Draw();

  lt = new TLatex(0.002,0.2,"#chi^{2} < 0.5");
  lt->Draw();

}
