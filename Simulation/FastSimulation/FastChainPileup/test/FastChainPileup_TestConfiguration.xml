<?xml version="1.0"?>
<!-- MB: Search for RUNNUMBER to replace the run input collections and setting -->
<!-- MB: xml file validation: http://www.hep.ucl.ac.uk/atlas/AtlasTesting/DTD/onlineValidation/validator.html -->
<!-- <!DOCTYPE unifiedTestConfiguration SYSTEM "https://test-rtt.web.cern.ch/test-rtt/brinick/Results/unifiedTestConfiguration.dtd"> --> <!-- xmltest
                                                                                                                                           -->
<!DOCTYPE unifiedTestConfiguration SYSTEM "http://www.hep.ucl.ac.uk/atlas/AtlasTesting/DTD/unifiedTestConfiguration.dtd"> <!-- official -->

<unifiedTestConfiguration>
  <atn/>
  <kv/>
  <rtt xmlns="http://www.hep.ucl.ac.uk/atlas/AtlasTesting/rtt">
    <rttContactPerson>
      Artem Basalaev
    </rttContactPerson>
    <mailto>
      artem.basalaev@cern.ch
    </mailto>
    <refRelease>
      20.3.0.Y-VAL
    </refRelease>
    <jobList>  
      <!-- Pile up CHAIN -->
      <chain>
       <chainName>ChainJobwthPileUp</chainName>
        <!-- Only letters allowed, no white space or punctuation in Name -->
       <sequential>
	<sequential>
	  <!-- Run FastChain -->
          <chainElement>
            <jobTransform userJobId="ttbarFastChain">
              <doc>FastChain</doc>
              <jobTransformJobName>ttbarFastChain</jobTransformJobName>
              <jobTransformCmd> 
		  FastChain_tf.py --simulator ATLFASTIIF_PileUp --digiSteeringConf "SplitNoMerge" --useISF True --randomSeed 123 --enableLooperKiller True --inputEVNTFile /afs/cern.ch/atlas/offline/ProdData/16.6.X/16.6.7.Y/ttbar_muplusjets-pythia6-7000.evgen.pool.root --outputRDOFile RDO_pileup.pool.root --maxEvents 100 --skipEvents 0 --geometryVersion ATLAS-R2-2015-03-01-00 --conditionsTag OFLCOND-RUN12-SDR-19 --preSimExec 'from TrkDetDescrSvc.TrkDetDescrJobProperties import TrkDetFlags;TrkDetFlags.TRT_BuildStrawLayers=True' --preSimInclude FastChainPileup/FastPileup.py --postInclude 'PyJobTransforms/UseFrontier.py,G4AtlasTests/postInclude.DCubeTest_FCpileup.py,DigitizationTests/postInclude.RDO_Plots.py' --postExec 'from AthenaCommon.ConfigurationShelve import saveToAscii;saveToAscii("config.txt")' --ignorePatterns='G4TestAlg.Lucid.{5}FATAL.{8}LucidHitsTestTool.cxx:66\ \(StatusCode\ LucidHitsTestTool::processEvent\(\)\):\ code\ 0:\ evtStore\(\)->retrieve\(iter\)'
              </jobTransformCmd>
	      <group>FastChainPileup</group>
              <queue>medium</queue>
            </jobTransform>
            <chainfileout>
              RDO_pileup.pool.root
            </chainfileout>
          </chainElement>
        </sequential>
	<parallel>
	  <chainElement>
	    <jobTransform userJobId="ttbarFastChain_Reg">
	      <doc>Regression test between releases</doc>
	      <jobTransformJobName>ttbarFastChain_Reg</jobTransformJobName>
	      <jobTransformCmd>sim_reg_test.py ttbarFastChain truth.root RDO_pileup.pool.root RDO_truth.root</jobTransformCmd>
	      <group>FastChainPileup</group>
	      <queue>medium</queue>
	      <test position="1">
		<modulename>RttLibraryTools</modulename>
		<testname>DiffPoolFilesRunner</testname>
		<testidentifier>HITS_RegressionTestRunner</testidentifier>
		<arg>
		  <argname>fileName</argname>
		  <argvalue>today.RDO_pileup.pool.root</argvalue>
		</arg>
		<arg>
		  <argname>refFileName</argname>
		  <argvalue>yesterday.RDO_pileup.pool.root</argvalue>
		</arg>
		<keepFilePattern>today.RDO_pileup.pool.root_yesterday.RDO_pileup.pool.root.diffPool</keepFilePattern>
	      </test>
	      <test position="2">
		  <modulename>RttLibraryTools</modulename>
		  <testname>ExeRunner</testname>
		  <arg>
		    <argname>exeName</argname>
		    <argvalue>acmd.py</argvalue>
		  </arg>
		  <arg>
		    <argname>exeParamString</argname>
		    <argvalue>diff-root yesterday.RDO_pileup.pool.root today.RDO_pileup.pool.root --ignore-leaves RecoTimingObj_p1_EVNTtoHITS_timings RecoTimingObj_p1_HITStoRDO_timings RecoTimingObj_p1_RAWtoESD_timings ESDtoAOD_timings ESDtoAOD_mems RAWtoESD_mems RAWtoESD_timings RecoTimingObj_p1_RAWtoESD_mems</argvalue>
		  </arg>
		  <keepFilePattern>RttLibraryTools_ExeRunner.postprocessing.log</keepFilePattern>
		</test>
		<test position="3">
	          <modulename>RttLibraryTools</modulename>
	          <testname>DCubeRunner</testname>
	          <arg>
	            <argname>DCubeCfg</argname>
	            <argvalue>dcube_truth.xml</argvalue>
	          </arg>
	          <arg>
	            <argname>DCubeRef</argname>
	            <argvalue>yesterday.truth.root</argvalue>
	          </arg>
		  <arg>
	            <argname>localRefFile</argname>
	            <argvalue>True</argvalue>
	          </arg>
	          <arg>
	            <argname>DCubeMon</argname>
	            <argvalue>today.truth.root</argvalue>
	          </arg>
	          <keepFilePattern>DCube-yesterday.truth.root/today.truth.root.dcube.xml.php</keepFilePattern>
	        </test>
		<test position="4">
	          <modulename>RttLibraryTools</modulename>
	          <testname>DCubeRunner</testname>
	          <arg>
	            <argname>DCubeCfg</argname>
	            <argvalue>dcube_RDO_truth.xml</argvalue>
	          </arg>
	          <arg>
	            <argname>DCubeRef</argname>
	            <argvalue>yesterday.RDO_truth.root</argvalue>
	          </arg>
		  <arg>
	            <argname>localRefFile</argname>
	            <argvalue>True</argvalue>
	          </arg>
	          <arg>
	            <argname>DCubeMon</argname>
	            <argvalue>today.RDO_truth.root</argvalue>
	          </arg>
	          <keepFilePattern>DCube-yesterday.RDO_truth.root/today.RDO_truth.root.dcube.xml.php</keepFilePattern>
	        </test>
	      </jobTransform>
	    </chainElement>
	    <chainElement>
	      <jobTransform userJobId="ttbarFastChain_CompareProdRDO">
		<doc>comparison RDO_truth.root with Production reference sample</doc>
		<jobTransformJobName>ttbarFastChain_CompareProdRDO</jobTransformJobName>
		<jobTransformCmd>sim_reg_test.py ttbarFastChain RDO_truth.root</jobTransformCmd>
		<group>FastChainPileup</group>
		<queue>medium</queue>
		<test>
		  <modulename>RttLibraryTools</modulename>
		  <testname>DCubeRunner</testname>
		  <arg>
		    <argname>DCubeCfg</argname>
		    <argvalue>dcube_RDO_truth_prod.xml</argvalue>
		  </arg>
		  <arg>
		    <argname>DCubeRef</argname>
		    <argvalue>RDO_truth_prod.root</argvalue>
		  </arg>
		  <arg>
		    <argname>DCubeMon</argname>
		    <argvalue>today.root</argvalue>
		  </arg>
		  <keepFilePattern>DCube/RDO_truth_prod.root/today.root.dcube.xml.php</keepFilePattern>
		</test>
	      </jobTransform>
	    </chainElement>
        </parallel>
       </sequential>
      </chain>
    </jobList>
    <jobGroups>
      <jobGroup name="FastChainPileup" parent="Top">
	<keepFilePattern>*.root</keepFilePattern>
	<keepFilePattern>*.txt</keepFilePattern>
	<keepFilePattern>*.out</keepFilePattern>
	<keepFilePattern>*.html</keepFilePattern>
	<keepFilePattern>prof/*.html</keepFilePattern>
	<keepFilePattern>*.php</keepFilePattern>
	<keepFilePattern>*log</keepFilePattern>
	<keepFilePattern>log*</keepFilePattern>
	<keepFilePattern>*.diffPool</keepFilePattern>
	<keepFilePattern>test.athena.profile</keepFilePattern>
      </jobGroup>
    </jobGroups>
  </rtt>
</unifiedTestConfiguration>
