<?xml version="1.0"?>
<!DOCTYPE unifiedTestConfiguration SYSTEM "http://www.hep.ucl.ac.uk/atlas/AtlasTesting/DTD/unifiedTestConfiguration.dtd">

<unifiedTestConfiguration>
  <atn/>
  <kv/>
  <rtt xmlns="http://www.hep.ucl.ac.uk/atlas/AtlasTesting/rtt" >
    <rttContactPerson>Overlay SRL</rttContactPerson>
    <mailto>atlas-srl-Overlay@cern.ch</mailto>
    <jobList>

      <chain>
        <chainName>MC12_2011_Legacy</chainName>
        <abortOnError />

        <sequential>
          <chainElement>
            <jobTransform userJobId="MC12_2011_Legacy_OverlayChain_tf">
              <doc></doc>
              <jobTransformJobName>MC12_2011_Legacy_OverlayChain_tf</jobTransformJobName>
              <jobTransformCmd>
                OverlayChain_tf.py --inputZeroBiasBSFile 'root://eosatlas//eos/atlas/user/r/redlinge/overlay//user.haastyle.BSmultipleselector.GRL.test9_EXT0.merge.32430.test12.120127073036/user.haastyle.101200.EXT5._00001.Zerobias1327678194q.bit-1.stream5.RAW' --outputBS_SKIMFile 'simpledummy.RAW' --outputRDOFile testRTT.RDO.pool.root  --triggerBit 240 --skipEvents 0 --maxEvents 10 --DataRunNumber 2011 --inputEVNTFile root://eosatlas//eos/atlas/user/r/redlinge/overlay/mc11_7TeV.105200.T1_McAtNlo_Jimmy.evgen.EVNT.e835_tid454603_00/EVNT.454603._000006.pool.root.1 --outputHITSFile testRTT.HITS.pool.root --randomSeed 123456789 --geometryVersion ATLAS-GEO-20-00-01 --conditionsTag COMCOND-BLKPA-006-11 --physicsList QGSP_BERT --digiSeedOffset1=211 --digiSeedOffset2=122 --samplingFractionDbTag QGSP_BERT_BIRK --fSampltag LARElecCalibMCfSampl-G494-DetailedAbs- --preInclude 'sim:EventOverlayJobTransforms/custom.py,EventOverlayJobTransforms/magfield.py' 'overlayBS:EventOverlayJobTransforms/UseOracle.py,EventOverlayJobTransforms/custom.py' --postInclude 'sim:EventOverlayJobTransforms/UseOracle.py,EventOverlayJobTransforms/Rt_override_BLKPA-006-11.py,EventOverlayJobTransforms/muAlign.py,EventOverlayJobTransforms/g4runnumber.py' 'overlayBS:EventOverlayJobTransforms/Rt_override_BLKPA-006-11.py' --postExec 'from IOVDbSvc.CondDB import conddb;conddb.blockFolder("/SCT/DAQ/Configuration/Chip");conddb.addFolderSplitMC("SCT","/SCT/DAQ/Configuration/Chip","/SCT/DAQ/Configuration/Chip",force=True);conddb.blockFolder("/SCT/DAQ/Configuration/Module");conddb.addFolderSplitMC("SCT","/SCT/DAQ/Configuration/Module","/SCT/DAQ/Configuration/Module",force=True)'
              </jobTransformCmd>
              <group>Overlay_JobTransforms</group>
              <queue>long</queue>
            </jobTransform>
            <chainfileout>testRTT.RDO.pool.root</chainfileout>
          </chainElement>

          <parallel>
            <chainElement>
              <!-- Regression Test on HITS -->
              <jobTransform userJobId="MC12_2011_Legacy_HITS_Reg">
                <doc>Regression test for HITS created by OverlayChain_tf.py</doc>
                <jobTransformJobName>MC12_2011_Legacy_HITS_Reg</jobTransformJobName>
                <jobTransformCmd>
                  sim_reg_test.py MC12_2011_Legacy_OverlayChain_tf testRTT.HITS.pool.root HITS.pool
                </jobTransformCmd>
                <group>Overlay_JobTransforms</group>
                <queue>short</queue>
                <test>
                  <modulename>FlexibleDiffPoolFilesRunner</modulename>
                  <testname>FlexibleDiffPoolFilesRunner</testname>
                  <testidentifier>HITS_RegressionTestRunner</testidentifier>
                  <arg>
                    <argname>platformDependent</argname>
                    <argvalue>True</argvalue>
                  </arg>
                  <arg>
                    <argname>doDetailedChecks</argname>
                    <argvalue>True</argvalue>
                  </arg>
                  <arg>
                    <argname>fileName</argname>
                    <argvalue>today.HITS.pool.root</argvalue>
                  </arg>
                  <arg>
                    <argname>refFileName</argname>
                    <argvalue>yesterday.HITS.pool.root</argvalue>
                  </arg>
                  <arg>
                    <argname>optionString</argname>
                    <argvalue>--ignore-leaves RecoTimingObj_p1_EVNTtoHITS_timings</argvalue>
                  </arg>
                  <keepFilePattern>today.HITS.pool.root_yesterday.HITS.pool.root.diffPool</keepFilePattern>
                </test>
                <testToRemove>
                  <jobGroupName>RTT:Top</jobGroupName>
                  <testidentifier>CheckFileRunner0</testidentifier>
                </testToRemove>
              </jobTransform>
            </chainElement>
            <chainElement>
              <!-- Regression Test on RDOs -->
              <jobTransform userJobId="MC12_2011_Legacy_RDO_Reg">
                <doc>Regression test for RDOs created by OverlayChain_tf.py</doc>
                <jobTransformJobName>MC12_2011_Legacy_RDO_Reg</jobTransformJobName>
                <jobTransformCmd>
                  sim_reg_test.py MC12_2011_Legacy_OverlayChain_tf testRTT.RDO.pool.root RDO.pool
                </jobTransformCmd>
                <group>Overlay_JobTransforms</group>
                <queue>short</queue>
                <test>
                  <modulename>FlexibleDiffPoolFilesRunner</modulename>
                  <testname>FlexibleDiffPoolFilesRunner</testname>
                  <testidentifier>RDO_RegressionTestRunner</testidentifier>
                  <arg>
                    <argname>platformDependent</argname>
                    <argvalue>True</argvalue>
                  </arg>
                  <arg>
                    <argname>doDetailedChecks</argname>
                    <argvalue>True</argvalue>
                  </arg>
                  <arg>
                    <argname>fileName</argname>
                    <argvalue>today.RDO.pool.root</argvalue>
                  </arg>
                  <arg>
                    <argname>refFileName</argname>
                    <argvalue>yesterday.RDO.pool.root</argvalue>
                  </arg>
                  <keepFilePattern>today.RDO.pool.root_yesterday.RDO.pool.root.diffPool</keepFilePattern>
                </test>
                <testToRemove>
                  <jobGroupName>RTT:Top</jobGroupName>
                  <testidentifier>CheckFileRunner0</testidentifier>
                </testToRemove>
              </jobTransform>
            </chainElement>

            <sequential>
              <chainElement>
                <jobTransform userJobId="MC12_2011_Legacy_Reco_tf">
                  <doc>Reco of MC+Data overlay</doc>
                  <jobTransformJobName>MC12_2011_Legacy_Reco_tf</jobTransformJobName>
                  <jobTransformCmd>
                    Reco_tf.py --inputRDOFile testRTT.RDO.pool.root --geometryVersion ATLAS-GEO-20-00-01 --conditionsTag COMCOND-BLKPA-006-11 --outputESDFile test.ESD.pool.root --outputAODFile test.AOD.pool.root --preInclude 'EventOverlayJobTransforms/UseOracle.py,EventOverlayJobTransforms/custom.py,EventOverlayJobTransforms/recotrfpre.py' --postInclude 'EventOverlayJobTransforms/Rt_override.py,EventOverlayJobTransforms/muAlign_reco.py' --postExec 'from IOVDbSvc.CondDB import conddb;conddb.addOverride("/CALO/CaloSwClusterCorrections","CaloSwClusterCorrections-00-02-11-v11_calh")'  'r2e:from AthenaCommon import CfgGetter;CfgGetter.getPublicTool("LArCellBuilderFromLArRawChannelTool").RawChannelsName = "LArRawChannels_FromDigits"' --preExec 'from CaloRec.CaloCellFlags import jobproperties;jobproperties.CaloCellFlags.doLArHVCorr.set_Value_and_Lock(False);muonRecFlags.writeSDOs=True' 'r2e:rec.RunNumber=0;rec.Commissioning.set_Value_and_Lock(True);jobproperties.Beam.numberOfCollisions.set_Value_and_Lock(20.0);from CaloRec.CaloCellFlags import jobproperties;jobproperties.CaloCellFlags.doLArCellEmMisCalib=False;include.block("TrigT2CaloCommon/LArCellBuilding.py");rec.doTrigger=False'
                  </jobTransformCmd>
                  <group>Overlay_JobTransforms</group>
                  <chaindataset_info>
                    <jobTransformData />
                    <chaindatasetName>testRTT.RDO.pool.root</chaindatasetName>
                    <dataset_info>
                      <dc2 />
                      <datasetName>/eos/atlas/user/r/redlinge/overlay/output.nightly.RDO.pool.root</datasetName>
                    </dataset_info>
                  </chaindataset_info>
                  <queue>medium</queue>
                </jobTransform>
                <chainfileout>testRTT.ESD.pool.root</chainfileout>
              </chainElement>
              <chainElement>
                <!-- Regression Test on ESDs -->
                <jobTransform userJobId="MC12_2011_Legacy_ESD_Reg">
                  <doc>Regression test for Reco_tf"</doc>
                  <jobTransformJobName>MC12_2011_Legacy_ESD_Reg</jobTransformJobName>
                  <jobTransformCmd>
                    sim_reg_test.py MC12_2011_Legacy_Reco_tf testRTT.ESD.pool.root ESD.pool
                  </jobTransformCmd>
                  <group>Overlay_JobTransforms</group>
                  <queue>short</queue>
                  <test>
                    <modulename>FlexibleDiffPoolFilesRunner</modulename>
                    <testname>FlexibleDiffPoolFilesRunner</testname>
                    <testidentifier>ESD_RegressionTestRunner</testidentifier>
                    <arg>
                      <argname>platformDependent</argname>
                      <argvalue>True</argvalue>
                    </arg>
                    <arg>
                      <argname>doDetailedChecks</argname>
                      <argvalue>True</argvalue>
                    </arg>
                    <arg>
                      <argname>fileName</argname>
                      <argvalue>today.ESD.pool.root</argvalue>
                    </arg>
                    <arg>
                      <argname>refFileName</argname>
                      <argvalue>yesterday.ESD.pool.root</argvalue>
                    </arg>
                    <arg>
                      <argname>optionString</argname>
                      <argvalue>--ignore-leaves RecoTimingObj_p1_EVNTtoHITS_timings RecoTimingObj_p1_HITStoRDO_timings RecoTimingObj_p1_RAWtoESD_timings RecoTimingObj_p1_RAWtoESD_mems TrackParticleAssocs_p1_GSFTrackAssociation</argvalue>
                    </arg>
                    <keepFilePattern>today.ESD.pool.root_yesterday.ESD.pool.root.diffPool</keepFilePattern>
                  </test>
                  <testToRemove>
                    <jobGroupName>RTT:Top</jobGroupName>
                    <testidentifier>CheckFileRunner0</testidentifier>
                  </testToRemove>
                </jobTransform>
              </chainElement>
            </sequential>

          </parallel>

        </sequential>

      </chain>

      <chain>
        <chainName>MC15_2012_pp</chainName>
        <abortOnError />

        <sequential>
          <chainElement>
            <jobTransform userJobId="MC15_2012_pp_OverlayChain_tf">
              <doc></doc>
              <jobTransformJobName>MC15_2012_pp_OverlayChain_tf</jobTransformJobName>
              <jobTransformCmd>
                OverlayChain_tf.py --inputZeroBiasBSFile root://eosatlas//eos/atlas/atlascerngroupdisk/proj-sit/overlay/group.dataprep.BSmultipleselector.GRL.test12p3_EXT0.merge.test3/group.dataprep.122036_100300.EXT0._00001.Zerobias1346848305_test12p3_dataset0.bit-1.stream0.RAW --outputBS_SKIMFile 'simpledummy.RAW' --outputRDOFile testRTT.RDO.pool.root --triggerBit 240 --skipEvents 10 --maxEvents 10 --DataRunNumber 2012 --inputEVNTFile root://eosatlas//eos/atlas/atlascerngroupdisk/proj-sit/overlay/mc12_8TeV.147807.PowhegPythia8_AU2CT10_Zmumu.evgen.EVNT.e1169/EVNT.756384._001055.pool.root.1 --outputHITSFile testRTT.HITS.pool.root --randomSeed 123456789 --geometryVersion ATLAS-R1-2012-03-00-00 --conditionsTag COMCOND-BLKPA-RUN1-08 --physicsList QGSP_BERT --digiSeedOffset1=211 --digiSeedOffset2=122 --samplingFractionDbTag QGSP_BERT_BIRK --fSampltag LARElecCalibMCfSampl-G494-DetailedAbs- --preInclude 'sim:EventOverlayJobTransforms/custom.py,EventOverlayJobTransforms/magfield.py' 'overlayBS:EventOverlayJobTransforms/UseOracle.py,EventOverlayJobTransforms/custom.py' --postInclude 'sim:EventOverlayJobTransforms/UseOracle.py,EventOverlayJobTransforms/Rt_override_BLKPA-006-11.py,EventOverlayJobTransforms/muAlign.py,EventOverlayJobTransforms/g4runnumber.py' 'overlayBS:EventOverlayJobTransforms/Rt_override_BLKPA-006-11.py' --postExec 'OverlayBS:from IOVDbSvc.CondDB import conddb;conddb.blockFolder("/SCT/DAQ/Configuration/Chip");conddb.addFolderSplitMC("SCT","/SCT/DAQ/Configuration/Chip","/SCT/DAQ/Configuration/Chip",force=True);conddb.blockFolder("/SCT/DAQ/Configuration/Module");conddb.addFolderSplitMC("SCT","/SCT/DAQ/Configuration/Module","/SCT/DAQ/Configuration/Module",force=True)'
              </jobTransformCmd>
              <group>Overlay_JobTransforms</group>
              <queue>long</queue>
            </jobTransform>
            <chainfileout>testRTT.RDO.pool.root</chainfileout>
          </chainElement>

          <parallel>
            <chainElement>
              <!-- Regression Test on HITS -->
              <jobTransform userJobId="MC15_2012_pp_HITS_Reg">
                <doc>Regression test for HITS created by OverlayChain_tf.py</doc>
                <jobTransformJobName>MC15_2012_pp_HITS_Reg</jobTransformJobName>
                <jobTransformCmd>
                  sim_reg_test.py MC15_2012_pp_OverlayChain_tf testRTT.HITS.pool.root HITS.pool
                </jobTransformCmd>
                <group>Overlay_JobTransforms</group>
                <queue>short</queue>
                <test>
                  <modulename>FlexibleDiffPoolFilesRunner</modulename>
                  <testname>FlexibleDiffPoolFilesRunner</testname>
                  <testidentifier>HITS_RegressionTestRunner</testidentifier>
                  <arg>
                    <argname>platformDependent</argname>
                    <argvalue>True</argvalue>
                  </arg>
                  <arg>
                    <argname>doDetailedChecks</argname>
                    <argvalue>True</argvalue>
                  </arg>
                  <arg>
                    <argname>fileName</argname>
                    <argvalue>today.HITS.pool.root</argvalue>
                  </arg>
                  <arg>
                    <argname>refFileName</argname>
                    <argvalue>yesterday.HITS.pool.root</argvalue>
                  </arg>
                  <arg>
                    <argname>optionString</argname>
                    <argvalue>--ignore-leaves RecoTimingObj_p1_EVNTtoHITS_timings</argvalue>
                  </arg>
                  <keepFilePattern>today.HITS.pool.root_yesterday.HITS.pool.root.diffPool</keepFilePattern>
                </test>
                <testToRemove>
                  <jobGroupName>RTT:Top</jobGroupName>
                  <testidentifier>CheckFileRunner0</testidentifier>
                </testToRemove>
              </jobTransform>
            </chainElement>
            <chainElement>
              <!-- Regression Test on RDOs -->
              <jobTransform userJobId="MC15_2012_pp_RDO_Reg">
                <doc>Regression test for RDOs created by OverlayChain_tf.py</doc>
                <jobTransformJobName>MC15_2012_pp_RDO_Reg</jobTransformJobName>
                <jobTransformCmd>
                  sim_reg_test.py MC15_2012_pp_OverlayChain_tf testRTT.RDO.pool.root RDO.pool
                </jobTransformCmd>
                <group>Overlay_JobTransforms</group>
                <queue>short</queue>
                <test>
                  <modulename>FlexibleDiffPoolFilesRunner</modulename>
                  <testname>FlexibleDiffPoolFilesRunner</testname>
                  <testidentifier>RDO_RegressionTestRunner</testidentifier>
                  <arg>
                    <argname>platformDependent</argname>
                    <argvalue>True</argvalue>
                  </arg>
                  <arg>
                    <argname>doDetailedChecks</argname>
                    <argvalue>True</argvalue>
                  </arg>
                  <arg>
                    <argname>fileName</argname>
                    <argvalue>today.RDO.pool.root</argvalue>
                  </arg>
                  <arg>
                    <argname>refFileName</argname>
                    <argvalue>yesterday.RDO.pool.root</argvalue>
                  </arg>
                  <keepFilePattern>today.RDO.pool.root_yesterday.RDO.pool.root.diffPool</keepFilePattern>
                </test>
                <testToRemove>
                  <jobGroupName>RTT:Top</jobGroupName>
                  <testidentifier>CheckFileRunner0</testidentifier>
                </testToRemove>
              </jobTransform>
            </chainElement>

            <sequential>
              <chainElement>
                <jobTransform userJobId="MC15_2012_pp_Reco_tf">
                  <doc>Reco of MC+Data overlay</doc>
                  <jobTransformJobName>MC15_2012_pp_Reco_tf</jobTransformJobName>
                  <jobTransformCmd>
                    Reco_tf.py --inputRDOFile testRTT.RDO.pool.root --geometryVersion ATLAS-R1-2012-03-00-00 --conditionsTag COMCOND-BLKPA-RUN1-08 --outputESDFile test.ESD.pool.root --outputAODFile test.AOD.pool.root --preInclude 'EventOverlayJobTransforms/UseOracle.py,EventOverlayJobTransforms/custom.py,EventOverlayJobTransforms/recotrfpre.py' --postInclude 'EventOverlayJobTransforms/Rt_override.py,EventOverlayJobTransforms/muAlign_reco.py' --postExec 'from IOVDbSvc.CondDB import conddb;conddb.addOverride("/CALO/CaloSwClusterCorrections","CaloSwClusterCorrections-00-02-11-v11_calh");conddb.addOverride("/GLOBAL/TrackingGeo/LayerMaterialV2","AtlasLayerMat_v19s0_ATLAS-R1-2012-02")' 'r2e:from AthenaCommon import CfgGetter;CfgGetter.getPublicTool("LArCellBuilderFromLArRawChannelTool").RawChannelsName = "LArRawChannels_FromDigits"' --preExec 'from CaloRec.CaloCellFlags import jobproperties;jobproperties.CaloCellFlags.doLArHVCorr.set_Value_and_Lock(False);muonRecFlags.writeSDOs=True' 'r2e:rec.RunNumber=0;rec.Commissioning.set_Value_and_Lock(True);jobproperties.Beam.numberOfCollisions.set_Value_and_Lock(20.0);from CaloRec.CaloCellFlags import jobproperties;jobproperties.CaloCellFlags.doLArCellEmMisCalib=False;include.block("TrigT2CaloCommon/LArCellBuilding.py");rec.doTrigger=False'                  </jobTransformCmd>
                  <group>Overlay_JobTransforms</group>
                  <chaindataset_info>
                    <jobTransformData />
                    <chaindatasetName>testRTT.RDO.pool.root</chaindatasetName>
                    <dataset_info>
                      <dc2 />
                      <datasetName>/eos/atlas/user/r/redlinge/overlay/output.nightly.RDO.pool.root</datasetName>
                    </dataset_info>
                  </chaindataset_info>
                  <queue>medium</queue>
                </jobTransform>
                <chainfileout>testRTT.ESD.pool.root</chainfileout>
              </chainElement>
              <chainElement>
                <!-- Regression Test on ESDs -->
                <jobTransform userJobId="MC15_2012_ESD_Reg">
                  <doc>Regression test for Reco_tf"</doc>
                  <jobTransformJobName>MC15_2012_ESD_Reg</jobTransformJobName>
                  <jobTransformCmd>
                    sim_reg_test.py MC15_2012_pp_Reco_tf testRTT.ESD.pool.root ESD.pool
                  </jobTransformCmd>
                  <group>Overlay_JobTransforms</group>
                  <queue>short</queue>
                  <test>
                    <modulename>FlexibleDiffPoolFilesRunner</modulename>
                    <testname>FlexibleDiffPoolFilesRunner</testname>
                    <testidentifier>ESD_RegressionTestRunner</testidentifier>
                    <arg>
                      <argname>platformDependent</argname>
                      <argvalue>True</argvalue>
                    </arg>
                    <arg>
                      <argname>doDetailedChecks</argname>
                      <argvalue>True</argvalue>
                    </arg>
                    <arg>
                      <argname>fileName</argname>
                      <argvalue>today.ESD.pool.root</argvalue>
                    </arg>
                    <arg>
                      <argname>refFileName</argname>
                      <argvalue>yesterday.ESD.pool.root</argvalue>
                    </arg>
                    <arg>
                      <argname>optionString</argname>
                      <argvalue>--ignore-leaves RecoTimingObj_p1_EVNTtoHITS_timings RecoTimingObj_p1_HITStoRDO_timings RecoTimingObj_p1_RAWtoESD_timings RecoTimingObj_p1_RAWtoESD_mems TrackParticleAssocs_p1_GSFTrackAssociation</argvalue>
                    </arg>
                    <keepFilePattern>today.ESD.pool.root_yesterday.ESD.pool.root.diffPool</keepFilePattern>
                  </test>
                  <testToRemove>
                    <jobGroupName>RTT:Top</jobGroupName>
                    <testidentifier>CheckFileRunner0</testidentifier>
                  </testToRemove>
                </jobTransform>
              </chainElement>
            </sequential>

          </parallel>

        </sequential>
      </chain>

    </jobList>



    <jobGroups>


      <jobGroup name="Overlay_JobTransforms" parent="Transform">
        <keepFilePattern>*</keepFilePattern>
        <test>
          <modulename>RttLibraryTools</modulename>
          <testname>CheckFileRunner</testname>
        </test>
      </jobGroup>


    </jobGroups>

  </rtt>
</unifiedTestConfiguration>
