#!/usr/bin/env python2.5
print 'Content-type: text/html;charset=utf-8\n'
import cgitb;cgitb.enable()

print '''
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>HVTrips database</title>
<meta name="author" content="Nikiforos Nikiforou <nikiforo@cern.ch>"/>
<link rel="icon" type="image/vnd.microsoft.icon" 
href="favicon.ico" />
<link rel="Stylesheet" href="styles.css" type="text/css" />
<base target="_self">
</head>
<body>
<div class="wrapper"><br />
<font style="font-size:20pt">HVTrips database test</font><br>
'''
cols = ['TripTimeStamp','RecoveryTimeStamp','HVLINE','RunNumber','TripLB','RecoveryLB','Comment']
import cgi,sqlite3,operator

query = cgi.FieldStorage()
a = []
for i in cols:
  if query.has_key(i): a.append( query.getvalue(i) )

conn = sqlite3.connect('trips.db')
c = conn.cursor()

if len(a)==len(cols):
  cmd = 'insert into TRIPS values %s' % ( str(tuple(a)) )
  c.execute(cmd)
  conn.commit()
elif len(a)>0: print 'Put entries in all the columns to edit the db file'

cmd = 'select * from TRIPS'
c.execute(cmd)
r = c.fetchall()

SortedTrips = sorted(r,key=operator.itemgetter(1))

print '<form method="post"><table class="list">\n<tr>\n'
for i in cols: print '<td>%s</td>\n' % (i)
print '</tr>\n<tr>\n'
for i in cols: print '<td><input type="text" name="%s"/></td>\n' % (i)
for i in range(len(SortedTrips)):
  print '<tr class="g%d">\n' % (i%2)
  for j in SortedTrips[i]: print '<td>%s</td>' % (j)
  print '</tr>\n'
print '</tr>\n</table><input type="submit" value="Submit"/></form>\n'
#for i in list_files: print '<a href="%s">%s</a><br>' % (i,i)
print '<div class="push"></div>\n</div>\n'
print '<div class="footer">Developer: Nikiforos Nikiforou<a href="mailto:eaolltt@gmail.com">&lt;nikiforo@cern.ch&gt;</a></div>\n'
print '</body>\n</html>'

c.close()
