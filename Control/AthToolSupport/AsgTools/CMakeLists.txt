# Copyright (C) 2002-2023 CERN for the benefit of the ATLAS collaboration

# Declare the package name:
atlas_subdir( AsgTools )

# Dependencies are taken based on what environment we are in:
if( XAOD_STANDALONE )
   set( libs xAODRootAccessInterfaces xAODRootAccess )
else()
   set( libs AthenaBaseComps AthenaKernel GaudiKernel )
endif()

# Decide which sources to use:
if( XAOD_STANDALONE )
   set( sources Root/*.cxx )
else()
   set( sources Root/AsgTool.cxx Root/AsgMetadataTool.cxx
      Root/MessageCheckAsgTools.cxx Root/ToolStore.cxx Root/AnaToolHandle.cxx
      Root/AsgComponentConfig.cxx Root/AsgToolConfig.cxx Root/AsgToolMacros.cxx
      src/*.cxx )
endif()

# Component(s) in the package:
atlas_add_library( AsgTools
   AsgTools/*.h AsgTools/*.icc ${sources}
   PUBLIC_HEADERS AsgTools
   LINK_LIBRARIES AsgMessagingLib CxxUtils ${libs} )

# Select which xml files to use for dictionary generation
atlas_add_dictionary( AsgToolsDict
   AsgTools/AsgToolsDict.h AsgTools/selection.xml
   LINK_LIBRARIES AsgTools )

if (XAOD_STANDALONE)
  atlas_add_dictionary( AsgToolsStandaloneDict
     AsgTools/AsgToolsStandaloneDict.h AsgTools/selection_standalone.xml
     LINK_LIBRARIES AsgTools )
endif ()

# Silence some warnings that are generated by the code on MacOS X:
set( extra_defs )
if( APPLE AND TARGET AsgTools )
   target_compile_options( AsgTools PUBLIC -Wno-tautological-undefined-compare )
endif()

# Utilities.
atlas_add_executable (asg_tools_test_init util/asg_tools_test_init.cxx
                      LINK_LIBRARIES AsgTools )

# Test(s) in the package:
if( XAOD_STANDALONE )
   atlas_add_test( BaseToolInit
      SCRIPT $<TARGET_FILE:asg_tools_test_init> "asg::AsgTool"
      POST_EXEC_SCRIPT nopost.sh )
   atlas_add_test( AsgComponentConfig_dictionary
      SCRIPT "${CMAKE_CURRENT_SOURCE_DIR}/test/AsgComponentConfig_dictionary_test.py" )
endif()
