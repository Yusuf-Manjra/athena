package Geant4

author Andrea DellAcqua <dellacqu@mail.cern.ch>
author Andy Buckley <andy.buckley@cern.ch>

use ExternalPolicy ExternalPolicy-*   External
use AtlasCLHEP     AtlasCLHEP-*       External
use AtlasXercesC   AtlasXercesC-*     External

ignore_pattern package_stamps

## Adapt standard macros for export
macro Geant4_home "${SITEROOT}/atlas/offline/external/geant4/releases" \
    BNL         "${SITEROOT}/cernsw/geant4/releases" \
    LBNL        "${SITEROOT}/sw/geant4/releases" \
    EXTSITE     "${SITEROOT}/geant4/releases" \
    STANDALONE  "${SITEROOT}/geant4/releases"


macro Geant4_native_version "geant4.9.6.patch03.atlas05"
macro Geant4_export_paths "$(Geant4_home)/share/${Geant4_native_version}/include $(Geant4_home)/specific/$(CMTCONFIG)/${Geant4_native_version}/lib $(Geant4_home)/share/${Geant4_native_version}/data"
macro Geant4_follow_symlinks "" PACK yes

private
# copied from ExternalPolicy with modification to restrict to one Geant4 version
# Pattern to install a symlink to the $(<package>_home) location of an external package in the InstallArea/external/<package> location.
# Subsequent use of the $(<package>_installed_home) macro to locate items within the package are then relocatable.   
# don't know how to loop in CMT language, so hardcode both paths which are currently needed here. Hope that will never change ...
pattern install_external_home \
    apply_pattern generic_declare_for_link kind=<package>_home files=$(<package>_home)/share/${Geant4_native_version} prefix=external/<package>/releases/share ; \
    apply_pattern generic_declare_for_link kind=<package>_home_specific files=$(<package>_home)/specific/$(CMTCONFIG)/${Geant4_native_version} prefix=external/<package>/releases/specific/$(CMTCONFIG) ; \
    macro <package>_installed_home "$(<package>_cmtpath)/$(cmt_installarea_prefix)/external/<package>/`basename $(<package>_home)`"


end_private

apply_pattern install_external_home package=Geant4

# *********************** This is G4 9.6 ************************
apply_tag G496

##################################################################

## G4 build variables

set G4VERS       "$(Geant4_native_version)"
set G4PATH       "$(Geant4_installed_home)"
set GEANT4       "$(Geant4_installed_home)/specific/$(CMTCONFIG)"
set Geant4_data  "$(Geant4_installed_home)/share/${Geant4_native_version}/data"
set G4INSTALL    "${GEANT4}/${Geant4_native_version}"
set G4INCLUDE    "$(Geant4_installed_home)/share/${Geant4_native_version}/include"
set G4LIB        "${G4INSTALL}/lib"

set G4SYSTEM      "Linux-g++" \
    target-darwin "Darwin-g++"

macro Geant4_cppflags  " -I${G4INCLUDE}/plists "
macro_append Geant4_cppflags  " -pipe -DGNU_GCC -fPIC "

macro_append Geant4_cppflags  " -DG4OPTIMIZE  " \
             debug            " -DG4DEBUG -DG4VERBOSE "

macro_append Geant4_cppflags  " -DG4USE_STD_NAMESPACE -DG4_STORE_TRAJECTORY -DG4USE_STL -DG4VIS_USE "
macro        Geant4_linkopts  " -L$(G4LIB)/$(G4SYSTEM)"


## G4 Kernel
macro_append Geant4_linkopts   "" \
             notAsNeeded       "" \
             asNeeded          " $(notAsNeeded_linkopt)"
macro_append Geant4_linkopts   " -lG4global -lG4event -lG4track -lG4geometry -lG4particles \
                                 -lG4digits_hits -lG4graphics_reps -lG4tracking -lG4intercoms \
                                 -lG4materials -lG4run -lG4Tree -lG4visHepRep "

macro_append Geant4_linkopts   "" \
             notAsNeeded       "" \
             asNeeded          " $(asNeeded_linkopt)"
macro_append Geant4_linkopts   " -lG4readout -lG4digits_hits "
macro_append Geant4_linkopts   " -lG4processes -lG4physicslists " \
             notAsNeeded       " -lG4processes -lG4physicslists " \
             asNeeded          " $(notAsNeeded_linkopt) -lG4processes -lG4physicslists $(asNeeded_linkopt) "

## G4 visualization
# TODO: Remove?
macro_append Geant4_linkopts   " -lG4vis_management -lG4modeling " \
             notAsNeeded       " -lG4vis_management -lG4modeling " \
             asNeeded          " $(notAsNeeded_linkopt) -lG4vis_management -lG4modeling $(asNeeded_linkopt) "

## G4 persistency
# TODO: Remove?
macro_append Geant4_linkopts   " -lG4persistency" \
             notAsNeeded       " -lG4persistency" \
             asNeeded          " $(notAsNeeded_linkopt) -lG4persistency $(asNeeded_linkopt) "

path_remove LD_LIBRARY_PATH    "/geant4/"


private
macro shlibsuffix "so" \
      Darwin      "dylib"

macro Geant4_ext_lib "$(Geant4_home)/specific/${CMTCONFIG}/${Geant4_native_version}/lib"
apply_pattern declare_installed_libraries dir="$(Geant4_ext_lib)/${G4SYSTEM} $(Geant4_ext_lib)/plists/${G4SYSTEM}"
public


# TODO: Remove?
#***************** DAWN (Fukui) Renderer *********************
#
set DAWN_HOME        ${SITEROOT}/sw/contrib/DAWN/3.85
set DAVID_HOME       ${SITEROOT}/sw/contrib/DAVID/1.34

set DAWN_BSD_UNIX_DOMAIN           "1"
set DAWN_GUI_ALWAYS                "1"

set G4VIS_USE_DAWN                 "1"
set G4VIS_USE_DAWNFILE             "1"
set G4DAWNFILE_VIEWER              "dawn"

macro_append  Geant4_cppflags  " -DG4VIS_USE_DAWN -DG4VIS_USE_DAWNFILE "
macro_append  Geant4_linkopts  " -lG4FR "

path_remove   PATH                "/DAWN/"
path_remove   PATH                "/DAVID/"
path_append   PATH "" G4Graphics  ${DAWN_HOME}/bin/Linux
path_append   PATH "" G4Graphics  ${DAWN_HOME}/../bin/Linux
path_append   PATH "" G4Graphics  ${DAVID_HOME}/bin/Linux


# TODO: Remove?
# ***************** Ray tracer ********************************

set G4VIS_USE_RAYTRACER        "1"
macro_append  Geant4_cppflags  " -DG4VIS_USE_RAYTRACER "
macro_append  Geant4_linkopts  " -lG4RayTracer "


# TODO: Remove?
# ***************** OPACS graphics ****************************

#set G4VIS_USE_OPACS          "1"
#use OPACSLIB v3	Vis
#macro_append Geant4_cppflags " -DG4VIS_USE_OPACS -DHAS_XO -DHAS_GO -DHAS_XM "
#macro_append Geant4_linkopts " -lG4OPACS -lG4UIOPACS "


# TODO: Remove?
# *************** VRML ***************************************

set G4VIS_USE_VRML             "1"
set G4VIS_USE_VRMLFILE         "1"
macro_append  Geant4_cppflags  " -DG4VIS_USE_VRML "
macro_append  Geant4_cppflags  " -DG4VIS_USE_VRMLFILE "
macro_append  Geant4_linkopts  " -lG4VRML "


# TODO: Remove?
# ************** Interfaces ************************************

set G4UI_USE_TERMINAL              "1"
set G4UI_USE_XM_SESSION            "1"
set G4UI_USE_WO                    "1"
set G4UI_USE_GAG                   "1"
macro_append  Geant4_cppflags  " -DG4UI_USE -DG4UI_USE_TERMINAL "
macro_append  Geant4_cppflags  " -DG4UI_USE_XM -DG4UI_USE_XAW "
macro_append  Geant4_cppflags  " -DG4UI_USE_WO -DG4UI_USE_GAG "
macro_append  Geant4_cppflags  " -DG4INTY_USE_XT "
macro_append  Geant4_linkopts  " -lG4interfaces "


# TODO: Remove?
# **************** OpenInventor *******************************

#set LALCONF                    "${CMTCONFIG}"
#set OIVHOME                    "${LAL_DIR}/SoFree/v3r2"
#set OIVBIN                     "${OIVHOME}/${LALCONF}"
#set HEPVISHOME                 "${LAL_DIR}/HEPVis/v5r1p8"
#set HEPVISBIN                  "${HEPVISHOME}/${LALCONF}"
#set G4VIS_USE_OIX              "1"
#set G4UI_USE_OIWIN32           " "
#set G4VIS_BUILD_OIWIN32_DRIVER " "
#set G4VIS_USE_OIWIN32          " "
#set G4VIS_BUILD_OIWIN32_DRIVER " "
#set OIVFLAGS "-I${HEPVISHOME}/include -DINVENTOR2_1 -I${OIVHOME}/include"
#set LIBTTF "/usr/lib/libttf.so" \
#    CERN   "/usr/lib/libttf.so.2"
#set OIVLIBS  "${LIBTTF} -L${HEPVISBIN} -lHEPVis -lHEPVisXt -L${OIVBIN} -lSoFree -lSoFreeXt"
#set SOFREEUSER "${OIVHOME}/user"
#macro_append  Geant4_cppflags  " -DG4VIS_USE_OI -DG4VIS_USE_OIX $(OIVFLAGS) "
#macro_append  Geant4_linkopts  ""
#macro_append Geant4_linkopts   " $(OIVLIBS)"
#path_remove LD_LIBRARY_PATH    "HEPVis"
#path_remove LD_LIBRARY_PATH    "SoFree"
#path_append LD_LIBRARY_PATH    "${HEPVISBIN}"
#path_append LD_LIBRARY_PATH    "${OIVBIN}"


# TODO: Remove?
# ***************** OpenGL ************************************

#set G4VIS_USE_OPENGLX          "1"
#set G4VIS_USE_OPENGLXM         "1"
#set XKEYSYMDB                  "/usr/lib/X11/XkeysymDB"
#set OGLHOME                    "${LHCXX_DIR}/Mesa/3.2"
#set OGLLIBS                    "-L${OGLHOME}/lib -lGLU -lGL"
#macro_append  Geant4_cppflags  " -DG4VIS_USE_OPENGLX -DG4VIS_USE_OPENGLXM "
#macro_append  Geant4_cppflags  " -DG4VIS_USE_OPENGL_DRIVER "
#macro_append  Geant4_linkopts  " -lG4OpenGL "
#macro_append  Geant4_linkopts  " $(OGLLIBS)"
#macro_append Geant4_linkopts   " -lXm -lXpm -lXaw -L$(X11R6)/lib -lXmu -lXt -lXext -lX11 -lSM -lICE "
#macro_append Geant4_linkopts   " -lXm -lXpm -lXaw -L$(X11R6)/lib -lXmu -lXt -lXext -lX11 "
#path_remove LD_LIBRARY_PATH    "Mesa"
#path_append LD_LIBRARY_PATH    "${OGLHOME}/lib"


# TODO: Remove?
# ***************** GDML ************************************

set G4LIB_BUILD_GDML         "1"
macro_append  Geant4_cppflags  " -DG4LIB_BUILD_GDML "
# Xerces
macro_append Geant4_linkopts  ""
macro_append Geant4_linkopts   " -lxerces-c" \
             notAsNeeded       "" \
             asNeeded          " $(notAsNeeded_linkopt) -lxerces-c $(asNeeded_linkopt) "


# ***************** CLHEP ************************************

macro_append Geant4_linkopts  ""
macro_append Geant4_linkopts   " -lCLHEP-Evaluator-$(CLHEP_native_version)" \
             notAsNeeded       "" \
             asNeeded          " $(notAsNeeded_linkopt) -lCLHEP-Evaluator-$(CLHEP_native_version) $(asNeeded_linkopt) "
macro_append Geant4_linkopts  ""
macro_append Geant4_linkopts   " -lCLHEP-Geometry-$(CLHEP_native_version)" \
             notAsNeeded       "" \
             asNeeded          " $(notAsNeeded_linkopt) -lCLHEP-Geometry-$(CLHEP_native_version) $(asNeeded_linkopt) "


# *********************** Include files ************************

macro X11R6   /usr/X11R6/
macro X11     /usr/include/X11
include_dirs   $(G4INCLUDE) $(OGLHOME)/include $(X11R6)/include $(X11R6)/include $(X11)/extensions $(X11)
set DAWN_HOME  ${SITEROOT}/sw/contrib/DAWN/3.85


# *********************** data files ************************

set G4LEVELGAMMADATA   "${Geant4_data}/PhotonEvaporation"
set G4NEUTRONHPDATA    "${Geant4_data}/G4NDL"
set G4LEDATA           "${Geant4_data}/G4EMLOW"
set G4NEUTRONXSDATA    "${Geant4_data}/G4NEUTRONXS"
set G4SAIDXSDATA       "${Geant4_data}/G4SAIDXSDATA"
