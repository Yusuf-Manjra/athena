package AtlasHepMCAnalysis

author Wolfgang Ehrenfeld <wolfgang.ehrenfeld@desy.de>
author S. Johnert <sebastian.johnert@desy.de>

use ExternalPolicy	ExternalPolicy-* 	External
use AtlasExternalArea   AtlasExternalArea-*     External
use AtlasFastJet	AtlasFastJet-*          External
use AtlasCLHEP		AtlasCLHEP-*		External
use AtlasHepMC       	AtlasHepMC-*          	External
use AtlasROOT		AtlasROOT-*		External -no_auto_imports
use LCG_Configuration

macro hepmcanalysis_native_version "00-03-04-14"

macro AtlasHepMCAnalysis_native_version "$(hepmcanalysis_native_version)"

macro AtlasHepMCAnalysis_lib  "$(AtlasHepMCAnalysis_root)/$(CMTCONFIG)/lib"

macro AtlasHepMCAnalysis_linkopts " -L$(AtlasHepMCAnalysis_lib) -lHepMCAnalysis "

macro AtlasHepMCAnalysis_include  "$(AtlasHepMCAnalysis_root)/$(CMTCONFIG)/HepMCAnalysis/include"

private

macro tardir "/afs/cern.ch/sw/lcg/external/tarFiles/MCGeneratorsTarFiles"

# chain of commands taken from LCGCMAKE build for LCG80:
#  just issue make with few env variables set

action external_untar "(cd ../$(CMTCONFIG); tar xvfz $(tardir)/HepMCAnalysis-$(AtlasHepMCAnalysis_native_version).tgz )"

action external_patch "(cd ../$(CMTCONFIG); patch -p0 < ../src/hepmcanalysis-00-03-04-14.patch )"

action external_make_compile "(cd ../$(CMTCONFIG)/HepMCAnalysis; make HepMCdir=$(HepMC_home) FastJetdir=$(fastjet_home) ROOTSYS=$(ROOT_home) CLHEPdir=$(CLHEP_home) CXXFLAGS='$(cppflags)')"

action external_make_install "(cd ../$(CMTCONFIG); cp -r -p HepMCAnalysis/lib/lib* . )"

# get dependencies of all actions correct, so all is done sequentially
macro_append external_patch_dependencies " external_untar "
macro_append external_make_compile_dependencies " external_patch "
macro_append external_make_install_dependencies " external_make_compile "

# trigger the chain of actions
macro_append constituents " external_make_install "

# install libraries
apply_pattern generic_declare_for_link kind=runtime files='-s=../$(CMTCONFIG) *.so' prefix='$(CMTCONFIG)/lib'
macro_append install_runtime_dependencies " external_make_install "

end_private

include_dirs "$(AtlasHepMCAnalysis_include)"
