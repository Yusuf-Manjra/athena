# File: cmt/fragments/merge_relax_map_header
# Author: Sebastien Binet (binet@cern.ch)
# $Id: merge_relax_map_header,v 1.4 2008-08-14 14:10:34 schaffer Exp $

#
#  Makefile fragment to merge a <package>Dict.dsomap file into 
#  a single <project>Dict.rootmap file in the install area
#

#dsoMapFile    := ${dict_dir}/${dictionary}/${dictionary}Dict.dsomap
dsoMapFile    := ${dso_map_file}
#dsoMapStamp   := ${CONSTITUENT}.stamp
dsoMapStamp   := $(bin)/${CONSTITUENT}.stamp
mergedDictMapdir := ${CMTINSTALLAREA}/$(tag)/lib
mergedDictMap := ${CMTINSTALLAREA}/$(tag)/lib/$(project)Dict.rootmap

# drive the running of this fragment off of a <package>Dict.dsomap.stamp file
#${CONSTITUENT} ::  $(dsoMapStamp) $(mergedDictMap)
${CONSTITUENT} :: $(dsoMapStamp) ;

#$(mergedDictMap) : ${CMTINSTALLAREA}/$(tag)/lib
#	touch $(mergedDictMap)

$(dsoMapFile) :
	touch $(dsoMapFile)

#ifeq ($(MAKE_VERSION),3.79.1)          # slc3
#$(dsoMapStamp)   : $(dsoMapFile) $(mergedDictMap)
#else
#$(dsoMapStamp)   : $(mergedDictMap) | $(dsoMapFile)
#endif
$(dsoMapStamp) : $(dsoMapFile)
	@echo "Running merge_relax_map  ${CONSTITUENT}. File: ${dsoMapFile} Map: ${mergedDictMap}"
	@-[ -d $(mergedDictMapdir) ] || mkdir -p $(mergedDictMapdir)
	@touch $(mergedDictMap)
	$(silent)$(merge_dict_rootmap_cmd) $(dsoMapFile) $(mergedDictMap)
	@echo "	sed -e "s/$(dso_lib_name)$$/$(dso_lib_name)\.so/g" $(mergedDictMap) "
	@-[ -d $(bin) ] || mkdir -p $(bin)
	$(silent)touch $(dsoMapStamp)

${CONSTITUENT}clean ::
	$(cleanup_silent) $(uninstall_command) $(dsoMapStamp)
