<?xml version="1.0"?>
<!-- MB: Search for RUNNUMBER to replace the run input collections and setting -->
<!-- MB: xml file validation: http://www.hep.ucl.ac.uk/atlas/AtlasTesting/DTD/onlineValidation/validator.html -->
<!-- <!DOCTYPE unifiedTestConfiguration SYSTEM "https://test-rtt.web.cern.ch/test-rtt/brinick/Results/unifiedTestConfiguration.dtd"> --> <!-- xmltest
                                                                                                                                           -->
<!DOCTYPE unifiedTestConfiguration SYSTEM "http://www.hep.ucl.ac.uk/atlas/AtlasTesting/DTD/unifiedTestConfiguration.dtd"> <!-- official -->

<unifiedTestConfiguration>
  <atn/>
  <kv/>
  <rtt xmlns="http://www.hep.ucl.ac.uk/atlas/AtlasTesting/rtt">
    <rttContactPerson>
      Serhat Istin
    </rttContactPerson>
    <mailto>
      istin@cern.ch
    </mailto>
    <refRelease>
      18.X.0
    </refRelease>
    <jobList>

      <!-- COSMICS CHAIN -->
	  <!-- retire the chain, not useful for Prod rel -->
          <!-- Run Simulation -->
          <!-- Run Digitisation -->
          <!-- Run Reconstruction -->
		  <!-- retired, cosmics trigger menu is not prod rel [ATR-10605] -->


      <!-- LONG RECONSTRUCTION CHAIN with fct_trf.py -->
      <chain>
        <chainName>digirecoAFSjob</chainName>
        <sequential>
          <!-- Run Digitisation and reconstruction with fct_trf -->
          <chainElement>
            <jobTransform userJobId="DigiReco_via_fct_trf">
              <doc>digireco</doc>
              <jobTransformJobName>MinBias_digi_Reco_trf</jobTransformJobName>
              <jobTransformCmd>
                fct_trf.py --config=$(echo $CMAKE_PREFIX_PATH | tr ":" "\n" |  head -n 1)/src/Tools/FullChainTests/test/digireco_MC12.cfg --runDigi --runReco
              </jobTransformCmd>
              <group>FCTTransform</group>
              <queue>long</queue>
              <batchWallTime>600</batchWallTime>
            </jobTransform>
            <chainfileout>
              digirecoAfs_mc12a.AOD.pool.root
            </chainfileout>
          </chainElement>
        </sequential>
      </chain>

      <!-- LONG RECONSTRUCTION CHAIN with fct_trf.py -->
      <chain>
        <chainName>digirecoAFSjob</chainName>
        <sequential>
          <!-- Run Digitisation and reconstruction with fct_trf -->
          <chainElement>
            <jobTransform userJobId="DigiReco_via_fct_trf_MC15c">
              <doc>digireco</doc>
              <jobTransformJobName>MinBias_digi_Reco_trf</jobTransformJobName>
              <jobTransformCmd>
                fct_trf.py --config=$(echo $CMAKE_PREFIX_PATH | tr ":" "\n" |  head -n 1)/src/Tools/FullChainTests/test/digireco_MC15c.cfg --runDigi --runReco
              </jobTransformCmd>
              <group>FCTTransform</group>
              <queue>long</queue>
              <batchWallTime>600</batchWallTime>
            </jobTransform>
            <chainfileout>
              digirecoAfs_mc15c.AOD.pool.root
            </chainfileout>
          </chainElement>
        </sequential>
      </chain>

      <!-- MC15c CHAIN -->
      <chain>
        <chainName>chainMC15c</chainName>
		<sequential>
		<parallel>
        <!-- Only letters allowed, no white space or punctuation in Name -->
        <sequential>
              <!-- Run Event Generation -->
              <chainElement>
                <!-- <jobTransform> -->
                <jobTransform userJobId="chainMC15c_ZhadEvgen">
                  <doc>evgen</doc>
                  <jobTransformJobName>Zhad_Generate_tf_e4581</jobTransformJobName>
                  <jobTransformCmd>
				  export JODIR=/cvmfs/atlas.cern.ch/repo/sw/Generators/MC15JobOptions/latest;export JOBOPTSEARCHPATH=$JODIR/share/DSID304xxx:$JOBOPTSEARCHPATH; Generate_tf.py --ecmEnergy 13000. --runNumber 304628 --firstEvent 1 --maxEvents 500 --randomSeed 54298752 --jobConfig MC15JobOptions/MC15.304628.Pythia8EvtGen_A14NNPDF23LO_ZHad_280_500.py --outputEVNTFile MC15.304628.Pythia8EvtGen_A14NNPDF23LO_ZHad_280_500.13TeV.EVNT.pool.root --postExec 'TestHepMC.EffFailThreshold=0.50'
                  </jobTransformCmd>
                  <group>FCTTransform</group>
                  <queue>short</queue>
                  <batchWallTime>300</batchWallTime>
                  <keepFilePattern>log.*</keepFilePattern>
                </jobTransform>
                <chainfileout>
                  MC15.304628.Pythia8EvtGen_A14NNPDF23LO_ZHad_280_500.13TeV.EVNT.pool.root
                </chainfileout>
              </chainElement>
              <!-- Run Simulation -->
              <chainElement>
                <jobTransform userJobId="chainMC15c_ZhadSimul">
                  <doc>simul</doc>
                  <jobTransformJobName>ZhadSimul_Sim_tf_s2726</jobTransformJobName>
                  <jobTransformCmd>
				  Sim_tf.py --conditionsTag "default:OFLCOND-RUN12-SDR-19" --DataRunNumber 222525 --DBRelease "default:current" --geometryVersion "default:ATLAS-R2-2015-03-01-00_VALIDATION" --physicsList FTFP_BERT --postInclude "default:PyJobTransforms/UseFrontier.py" --preInclude "EVNTtoHITS:SimulationJobOptions/preInclude.BeamPipeKill.py,SimulationJobOptions/preInclude.FrozenShowersFCalOnly.py" --runNumber=304628 --simulator MC12G4 --truthStrategy MC15aPlus --inputEVNTFile MC15.304628.Pythia8EvtGen_A14NNPDF23LO_ZHad_280_500.13TeV.EVNT.pool.root --outputHITSFile MC15.304628.Pythia8EvtGen_A14NNPDF23LO_ZHad_280_500.13TeV.HITS.pool.root --maxEvents 10
                  </jobTransformCmd>
                  <group>FCTTransform</group>
                  <chaindataset_info>
                    <jobTransformData />
                    <chaindatasetName>
                      MC15.304628.Pythia8EvtGen_A14NNPDF23LO_ZHad_280_500.13TeV.EVNT.pool.root
                    </chaindatasetName>
                    <dataset_info>
                      <jobTransformData />
                      <datasetName>
				        /cvmfs/atlas-nightlies.cern.ch/repo/data/data-art/FullChainTests/MC15.304628.Pythia8EvtGen_A14NNPDF23LO_ZHad_280_500.13TeV.EVNT.pool.root
                      </datasetName>
                    </dataset_info>
                  </chaindataset_info>
                  <queue>long</queue>
                  <batchWallTime>
                    300
                  </batchWallTime>
                </jobTransform>
                <chainfileout>
                  MC15.304628.Pythia8EvtGen_A14NNPDF23LO_ZHad_280_500.13TeV.HITS.pool.root
                </chainfileout>
              </chainElement>
              <!-- Run Digitisation and Reconstruction -->
              <chainElement>
                <jobTransform userJobId="chainMC15c_ZhadDigiReco">
                  <doc>digireco</doc>
                  <jobTransformJobName>ZhadDigiReco_Reco_tf_r7772</jobTransformJobName>
                  <jobTransformCmd>
				  Reco_tf.py --autoConfiguration everything --conditionsTag "default:OFLCOND-MC15c-SDR-09" --digiSteeringConf='StandardSignalOnlyTruth' --geometryVersion "default:ATLAS-R2-2015-03-01-00" --ignorePatterns Py:TrigConf2COOLLib.py --numberOfCavernBkg 0 --numberOfHighPtMinBias 0.12268057 --numberOfLowPtMinBias 39.8773194 --pileupFinalBunch 6 --postExec "all:CfgMgr.MessageSvc().setError+=[\"HepMcParticleLink\"]" "ESDtoAOD:fixedAttrib=[s if \"CONTAINER_SPLITLEVEL = \'99\'\" not in s else \"\" for s in svcMgr.AthenaPoolCnvSvc.PoolAttributes];svcMgr.AthenaPoolCnvSvc.PoolAttributes=fixedAttrib" --postInclude "default:RecJobTransforms/UseFrontier.py" --preExec "all:rec.Commissioning.set_Value_and_Lock(True);from AthenaCommon.BeamFlags import jobproperties;jobproperties.Beam.numberOfCollisions.set_Value_and_Lock(20.0);from LArROD.LArRODFlags import larRODFlags;larRODFlags.NumberOfCollisions.set_Value_and_Lock(20);larRODFlags.nSamples.set_Value_and_Lock(4);larRODFlags.doOFCPileupOptimization.set_Value_and_Lock(True);larRODFlags.firstSample.set_Value_and_Lock(0);larRODFlags.useHighestGainAutoCorr.set_Value_and_Lock(True)" "RAWtoESD:from CaloRec.CaloCellFlags import jobproperties;jobproperties.CaloCellFlags.doLArCellEmMisCalib=False" "ESDtoAOD:TriggerFlags.AODEDMSet=\"AODSLIM\"" --preInclude "HITtoRDO:Digitization/ForceUseOfPileUpTools.py,SimulationJobOptions/preInclude.PileUpBunchTrainsMC15_2015_25ns_Config1.py,RunDependentSimData/configLumi_run284500_v2.py" "RDOtoRDOTrigger:RecExPers/RecoOutputMetadataList_jobOptions.py" --runNumber 304628 --steering "doRDO_TRIG" --triggerConfig "RDOtoRDOTrigger=MCRECO:DBF:TRIGGERDBMC:2046,20,56" --inputHighPtMinbiasHitsFile /afs/cern.ch/atlas/project/rig/referencefiles/mc15_minBias/mc15_13TeV.361035.Pythia8EvtGen_A2MSTW2008LO_minbias_inelastic_high.merge.HITS.e3581_s2578_s2195/HITS.05608152._002335.pool.root.1 --inputLowPtMinbiasHitsFile /afs/cern.ch/atlas/project/rig/referencefiles/mc15_minBias/mc15_13TeV.361034.Pythia8EvtGen_A2MSTW2008LO_minbias_inelastic_low.merge.HITS.e3581_s2578_s2195/HITS.05608147._000125.pool.root.1 --digiSeedOffset1 1 --digiSeedOffset2 2 --inputHITSFile MC15.304628.Pythia8EvtGen_A14NNPDF23LO_ZHad_280_500.13TeV.HITS.pool.root --outputAODFile MC15.304628.Pythia8EvtGen_A14NNPDF23LO_ZHad_280_500.13TeV.AOD.pool.root --jobNumber 1 --maxEvents 10
                  </jobTransformCmd>
                  <group>FCTTransform</group>
                  <chaindataset_info>
                    <jobTransformData />
                    <chaindatasetName>
                      MC15.304628.Pythia8EvtGen_A14NNPDF23LO_ZHad_280_500.13TeV.HITS.pool.root
                    </chaindatasetName>
                    <dataset_info>
                      <jobTransformData />
                      <datasetName>
                        /afs/cern.ch/atlas/offline/external/FullChainTest/long/rtt.fallback/MC15/MC15.304628.Pythia8EvtGen_A14NNPDF23LO_ZHad_280_500.13TeV.HITS.pool.root
                      </datasetName>
                    </dataset_info>
                  </chaindataset_info>
                  <queue>long</queue>
                  <batchWallTime>300</batchWallTime>
                </jobTransform>
                <chainfileout>
                  MC15.304628.Pythia8EvtGen_A14NNPDF23LO_ZHad_280_500.13TeV.AOD.pool.root
                </chainfileout>
              </chainElement>
        </sequential>


        <sequential>
              <!-- Minbias Event Generation -->
              <chainElement>
                <!-- <jobTransform> -->
                <jobTransform userJobId="chainMC15c_MinbiasEvgen">
				<!-- create minbias chain similar to above Zhad r7725 MC15c chain -->
                  <doc>evgen</doc>
                  <jobTransformJobName>MinbiasEvgen_r7725</jobTransformJobName>
                  <jobTransformCmd>
				  export JODIR=/cvmfs/atlas.cern.ch/repo/sw/Generators/MC15JobOptions/latest;export JOBOPTSEARCHPATH=$JODIR/share/DSID361xxx:$JOBOPTSEARCHPATH; Generate_tf.py --ecmEnergy=13000. --runNumber=361033 --firstEvent=1 --maxEvents=5000 --randomSeed=8917284 --jobConfig=MC15.361033.Pythia8EvtGen_A2MSTW2008LO_minbias_inelastic.py --outputEVNTFile=MC15.361033.Pythia8EvtGen_A2MSTW2008LO_minbias_inelastic.13TeV.EVNT.pool.root
                  </jobTransformCmd>
                  <group>FCTTransform</group>
                  <queue>short</queue>
                  <batchWallTime>300</batchWallTime>
                  <keepFilePattern>log.*</keepFilePattern>
                </jobTransform>
                <chainfileout>
                  MC15.361033.Pythia8EvtGen_A2MSTW2008LO_minbias_inelastic.13TeV.EVNT.pool.root
                </chainfileout>
              </chainElement>
              <!-- Run Simulation -->
              <chainElement>
                <jobTransform userJobId="chainMC15c_MinbiasSimul">
                  <doc>simul</doc>
                  <jobTransformJobName>MinbiasSimul_r7725</jobTransformJobName>
                  <jobTransformCmd>
				  Sim_tf.py --conditionsTag "default:OFLCOND-RUN12-SDR-19" --DataRunNumber 222525 --DBRelease "default:current" --geometryVersion "default:ATLAS-R2-2015-03-01-00_VALIDATION" --physicsList FTFP_BERT --postInclude "default:PyJobTransforms/UseFrontier.py" --preInclude "EVNTtoHITS:SimulationJobOptions/preInclude.BeamPipeKill.py,SimulationJobOptions/preInclude.FrozenShowersFCalOnly.py" --runNumber=304628 --simulator MC12G4 --truthStrategy MC15aPlus --inputEVNTFile MC15.361033.Pythia8EvtGen_A2MSTW2008LO_minbias_inelastic.13TeV.EVNT.pool.root --outputHITSFile MC15.361033.Pythia8EvtGen_A2MSTW2008LO_minbias_inelastic.13TeV.HITS.pool.root --maxEvents=10
                  </jobTransformCmd>
                  <group>FCTTransform</group>
                  <chaindataset_info>
                    <jobTransformData />
                    <chaindatasetName>
                      MC15.361033.Pythia8EvtGen_A2MSTW2008LO_minbias_inelastic.13TeV.EVNT.pool.root
                    </chaindatasetName>
                    <dataset_info>
                      <jobTransformData />
                      <datasetName>
                        <!-- /afs/cern.ch/atlas/offline/external/FullChainTest/long/rtt.fallback/MC12/MC12.108351.pythia_minbias.8TeV.EVNT.pool.root -->
						/cvmfs/atlas-nightlies.cern.ch/repo/data/data-art/MC15.361033.Pythia8EvtGen_A2MSTW2008LO_minbias_inelastic.13TeV.EVNT.pool.root
                      </datasetName>
                    </dataset_info>
                  </chaindataset_info>
                  <queue>long</queue>
                  <batchWallTime>
                    300
                  </batchWallTime>
                </jobTransform>
                <chainfileout>
                  MC15.361033.Pythia8EvtGen_A2MSTW2008LO_minbias_inelastic.13TeV.HITS.pool.root
                </chainfileout>
              </chainElement>

			  <!-- cavern output missing in output, 20.7 ok in ATLASSIM-3214 -->
              <chainElement>
                <jobTransform userJobId="chainMC15c_minbiasEvt2CavernEvt">
                  <doc>evgen</doc>
                  <jobTransformJobName>minbiasEvt2CavernEvt_r7725</jobTransformJobName>
                  <jobTransformCmd>
				  AtlasG4_tf.py --inputEVNTFile 'MC15.361033.Pythia8EvtGen_A2MSTW2008LO_minbias_inelastic.13TeV.EVNT.pool.root' --outputHITSFile 'discard.HITS.pool.root' --outputEVNT_CAVERNTRFile 'MC15.cavbg13TeV.EVNT.pool.root' --maxEvents 10 --skipEvents 0 --geometryVersion 'default:ATLAS-R2-2015-03-01-00_VALIDATION' --conditionsTag 'default:OFLCOND-RUN12-SDR-19' --DataRunNumber='222525' --physicsList 'FTFP_BERT' --randomSeed 5678 --preInclude 'SimulationJobOptions/preInclude.G4WriteCavern.py' --postInclude 'PyJobTransforms/UseFrontier.py'
                  </jobTransformCmd>
                  <group>FCTTransform</group>
                  <chaindataset_info>
                    <jobTransformData />
                    <chaindatasetName>
                      MC15.361033.Pythia8EvtGen_A2MSTW2008LO_minbias_inelastic.13TeV.EVNT.pool.root
                    </chaindatasetName>
                    <dataset_info>
                      <jobTransformData />
                      <datasetName>
                        /afs/cern.ch/atlas/offline/external/FullChainTest/long/rtt.fallback/MC12/MC12.108351.pythia_minbias.8TeV.EVNT.pool.root
                      </datasetName>
                    </dataset_info>
                  </chaindataset_info>
                  <queue>long</queue>
                  <batchWallTime>300</batchWallTime>
                </jobTransform>
                <chainfileout>
                  MC15.cavbg13TeV.EVNT.pool.root
                </chainfileout>
              </chainElement>
              <!-- Run Simulation -->
              <chainElement>
                <jobTransform userJobId="chainMC15c_cavernSimul">
                  <doc>simul</doc>
                  <jobTransformJobName>cavernSimul_r7725</jobTransformJobName>
                  <jobTransformCmd>
				  Sim_tf.py --simulator 'MC12G4' --inputEVNT_CAVERNFile 'MC15.cavbg13TeV.EVNT.pool.root' --outputHITSFile 'MC15.cavbg13TeV.HITS.pool.root' --maxEvents -1 --skipEvents 0 --geometryVersion 'default:ATLAS-R2-2015-03-01-00_VALIDATION' --conditionsTag 'default:OFLCOND-RUN12-SDR-19' --DataRunNumber '222525' --physicsList 'FTFP_BERT' --enableLooperKiller 'True' --randomSeed 8765 --preInclude 'EVNTtoHITS:SimulationJobOptions/preInclude.BeamPipeKill.py,SimulationJobOptions/preInclude.G4ReadCavern.py' --postInclude 'PyJobTransforms/UseFrontier.py' --ignorePatterns='ToolSvc.ISFG4.+ERROR\s+ISF_to_G4Event.+article.conversion.failed'
                  </jobTransformCmd>
                  <group>FCTTransform</group>
                  <chaindataset_info>
                    <jobTransformData />
                    <chaindatasetName>
                      MC15.cavbg13TeV.EVNT.pool.root
                    </chaindatasetName>
                    <dataset_info>
                      <jobTransformData />
                      <datasetName>
                        /afs/cern.ch/atlas/offline/external/FullChainTest/long/rtt.fallback/MC12/MC12.cavbg8TeV.EVNT.pool.root
                      </datasetName>
                    </dataset_info>
                  </chaindataset_info>
                  <queue>long</queue>
                  <batchWallTime>300</batchWallTime>
                </jobTransform>
                <chainfileout>
                  MC15.cavbg13TeV.HITS.pool.root
                </chainfileout>
              </chainElement>
        </sequential>
		</parallel>

          <!-- Pileup DIY -->
          <!-- Run DigiReco -->
          <chainElement>
            <jobTransform userJobId="chainMC15c_pileupDigiReco">
              <doc>digireco</doc>
              <jobTransformJobName>pileupDigiReco_endofchain</jobTransformJobName>
              <jobTransformCmd>
			  Reco_tf.py --inputHITSFile MC15.304628.Pythia8EvtGen_A14NNPDF23LO_ZHad_280_500.13TeV.HITS.pool.root --outputRDOFile MC15.Pileup.RDO.pool.root --outputESDFile 'MC15.Pileup.ESD.pool.root' --outputAODFile 'MC15.Pileup.AOD.pool.root' --maxEvents 2 --jobNumber 1 --skipEvents 0 --geometryVersion 'ATLAS-R2-2015-03-01-00' --conditionsTag 'OFLCOND-RUN12-SDR-21' --DataRunNumber='222525' --digiSeedOffset1 123456 --digiSeedOffset2 2345678 --LowPtMinbiasHitsFile 'MC15.361033.Pythia8EvtGen_A2MSTW2008LO_minbias_inelastic.13TeV.HITS.pool.root' --cavernHitsFile 'MC15.cavbg13TeV.HITS.pool.root' --preInclude 'HITtoRDO:SimulationJobOptions/preInclude.PileUpBunchTrainsMC15_2015_25ns_Config1.py,Digitization/ForceUseOfPileUpTools.py,RunDependentSimData/configLumi_run284500_v2.py' --postInclude 'PyJobTransforms/UseFrontier.py'
              </jobTransformCmd>
              <group>FCTTransform</group>
              <chaindataset_info>
                <jobTransformData />
                <chaindatasetName>
                  MC15.304628.Pythia8EvtGen_A14NNPDF23LO_ZHad_280_500.13TeV.HITS.pool.root
                </chaindatasetName>
                <dataset_info>
                  <jobTransformData />
                  <datasetName>
                    /afs/cern.ch/atlas/offline/external/FullChainTest/long/rtt.fallback/MC12/MC12.147818.Pythia8_AU2CTEQ6L1_Ztautau.8TeV.HITS.pool.root
                  </datasetName>
                </dataset_info>
              </chaindataset_info>
              <chaindataset_info>
                <jobTransformData />
                <chaindatasetName>
                  MC15.361033.Pythia8EvtGen_A2MSTW2008LO_minbias_inelastic.13TeV.HITS.pool.root
                </chaindatasetName>
                <dataset_info>
                  <jobTransformData />
                  <datasetName>
                    /afs/cern.ch/atlas/offline/external/FullChainTest/long/rtt.fallback/MC12/MC12.108351.pythia_minbias.8TeV.HITS.pool.root
                  </datasetName>
                </dataset_info>
              </chaindataset_info>
              <chaindataset_info>
                <jobTransformData />
                <chaindatasetName>
                  MC15.cavbg13TeV.HITS.pool.root
                </chaindatasetName>
                <dataset_info>
                  <jobTransformData />
                  <datasetName>
                    /afs/cern.ch/atlas/offline/external/FullChainTest/long/rtt.fallback/MC12/MC12.cavbg8TeV.HITS.pool.root
                  </datasetName>
                </dataset_info>
              </chaindataset_info>
              <queue>long</queue>
              <batchWallTime>300</batchWallTime>
            </jobTransform>
            <chainfileout>
              MC15.Pileup.AOD.pool.root
            </chainfileout>
          </chainElement>
	    </sequential>
      </chain>

    </jobList>
    <jobGroups>
      <jobGroup name="FCTTransform" parent="Transform">
        <keepFilePattern>
          *.root
        </keepFilePattern>
        <keepFilePattern>
          *.pdf
        </keepFilePattern>
        <keepFilePattern>
          *.log
        </keepFilePattern>
        <keepFilePattern>
          log.*
        </keepFilePattern>
      </jobGroup>
    </jobGroups>
  </rtt>
</unifiedTestConfiguration>
